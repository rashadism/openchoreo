apiVersion: openchoreo.dev/v1alpha1
kind: Component
metadata:
  name: greeter-service
  namespace: default
spec:
  owner:
    projectName: default

  componentType: deployment/service

  parameters:
    exposed: true
    replicas: 1
    port: 9090
    resources:
      requests:
        cpu: "100m"
        memory: "256Mi"
      limits:
        cpu: "500m"
        memory: "512Mi"

---

# Defines a workload that specifies the developer contract which describes the source code including
# what configuration is needed to run, what endpoints are exposed, and how it connects to other components or platform resources.
apiVersion: openchoreo.dev/v1alpha1
kind: Workload
metadata:
  name: greeter-service-workload
  namespace: default
spec:
  owner:
    componentName: greeter-service
    projectName: default
  containers:
    main:
      image: "ghcr.io/openchoreo/samples/greeter-service:latest"
      command:
        - ./go-greeter
      args:
        - --port
        - "9090"
      env:
        - key: LOG_LEVEL
          value: "info"
        - key: GITHUB_REPOSITORY
          value: "https://github.com/openchoreo/openchoreo"
        - key: GITHUB_TOKEN
          valueFrom:
            secretRef:
              key: token
              name: github-credentials

---

apiVersion: openchoreo.dev/v1alpha1
kind: ComponentDeployment
metadata:
  name: greeter-service-development
  namespace: default
spec:
  owner:
    projectName: default
    componentName: greeter-service

  environment: development

---

# SecretReference that creates an ExternalSecret pointing to your secret store
# This will automatically create a Kubernetes Secret named 'github-credentials'
apiVersion: openchoreo.dev/v1alpha1
kind: SecretReference
metadata:
  name: github-credentials
  namespace: default
spec:
  template:
    type: Opaque
    metadata:
      labels:
        app: greeter-service
  data:
    - secretKey: token
      remoteRef:
        key: github-pat
  refreshInterval: 1h

