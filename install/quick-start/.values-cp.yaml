# Helm values for OpenChoreo Control Plane in quick-start container
# Note: devMode adds :8080 to URLs (k3d port mapping), disables HTTPS

global:
  baseDomain: openchoreo.localhost
  port: ":8080"

# Disable cluster gateway for quick-start (direct access mode)
clusterGateway:
  enabled: true

controllerManager:
  clusterGateway:
    enabled: true

thunder:
  configuration:
    server:
      publicUrl: "http://thunder.openchoreo.localhost:8080"
    gateClient:
      hostname: "thunder.openchoreo.localhost"
      port: 8080
      scheme: "http"

gateway:
  # Enable gateway
  enabled: true

  # Envoy - enabled by default for traffic routing
  envoy:
    enabled: true
    # Mount /tmp as emptyDir volume to fix Envoy temporary file creation issues
    # Enable this if gateway pods crash with "Failed to create temporary file" errors
    # Common on: macOS with Docker Desktop/Colima with Rosetta enabled.
    # Ref: https://github.com/kgateway-dev/kgateway/issues/9800
    mountTmpVolume: true

# Security configuration for quickstart
security:
openchoreoApi:
  config:
    security:
      authorization:
        bootstrap:
          mappings:
            # Super admin mapping - grants platformEngineer group full access
            - name: super-admin-binding
              roleRef:
                name: super-admin
              entitlement:
                claim: groups
                value: platformEngineer
              effect: allow

            # Backstage catalog reader mapping - grants backstage service account read access
            - name: backstage-catalog-reader-binding
              roleRef:
                name: backstage-catalog-reader
              entitlement:
                claim: sub
                value: openchoreo-backstage-client
              effect: allow

            # RCA agent mapping - grants RCA service account troubleshooting access
            - name: rca-agent-binding
              roleRef:
                name: rca-agent
              entitlement:
                claim: sub
                value: openchoreo-rca-agent
              effect: allow

            # Quickstart CLI client credentials mapping
            - name: quickstart-cli-super-admin-binding
              roleRef:
                name: super-admin
              entitlement:
                claim: sub
                value: openchoreo-cli-quickstart
              effect: allow
