{{- if .Values.k3d.dnsRewrite.enabled }}
apiVersion: v1
kind: ConfigMap
metadata:
  name: coredns-custom
  namespace: kube-system
  labels:
    {{- include "openchoreo-data-plane.labels" . | nindent 4 }}
    app.kubernetes.io/component: k3d-dns
data:
  cluster-gateway.override: |
    # Rewrite cluster gateway hostname to use host.k3d.internal
    # This allows agents in multi-cluster k3d setups to reach the control plane
    rewrite stop {
      name exact cluster-gateway.openchoreo.localhost host.k3d.internal
      answer auto
    }
{{- end }}
