{{- if .Values.clusterAgent.enabled }}
{{- if .Values.clusterAgent.tls.enabled }}
{{- if .Values.clusterAgent.tls.caValue }}
---
# Secret created from inline CA certificate value (multi-cluster setup)
# This secret contains the cluster gateway CA certificate for signing agent client certificates
# Used when observability plane is in a different cluster from control plane
apiVersion: v1
kind: Secret
metadata:
  name: {{ .Values.clusterAgent.tls.caSecretName | default "cluster-gateway-ca" }}
  namespace: {{ .Release.Namespace }}
  labels:
    {{- include "openchoreo-observability-plane.labels" . | nindent 4 }}
    app.kubernetes.io/component: cluster-agent
    openchoreo.dev/created-from: inline-value
  annotations:
    helm.sh/hook: pre-install,pre-upgrade
    helm.sh/hook-weight: "-6"
    helm.sh/hook-delete-policy: before-hook-creation
type: Opaque
data:
  ca.crt: {{ .Values.clusterAgent.tls.caValue | b64enc }}
{{- end }}
{{- end }}
{{- end }}
