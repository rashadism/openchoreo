# Global values shared across all components
global:
  # Common labels to add to all resources
  commonLabels: {}

  # Installation mode for the OpenChoreo Observability Plane
  # standard: Operator managed OpenSearch cluster will be deployed
  # minimal: Single replica OpenSearch instance will be deployed
  installationMode: minimal

data-prepper:
  enabled: false
  fullnameOverride: "data-prepper"

  pipelineConfig:
    enabled: true
    config:
      trace-pipeline:
        delay: "100"
        source:
          otel_trace_source:
            ssl: false
        buffer:
          bounded_blocking:
            buffer_size: 12800
            batch_size: 200
        sink:
          - opensearch:
              hosts: ["http://opensearch:9200"]
              insecure: true
              index_type: trace-analytics-raw

  resources:
    limits:
      cpu: 1000m
      memory: 500Mi
    requests:
      cpu: 1000m
      memory: 500Mi

openSearch:
  enabled: true

  extraEnvs:
    - name: OPENSEARCH_INITIAL_ADMIN_PASSWORD
      value: ThisIsTheOpenSearchPassword1
    - name: DISABLE_SECURITY_PLUGIN
      value: "true"
  nameOverride: "opensearch"
  image:
    tag: "3.3.0"
  masterService: opensearch

  rbac:
    create: true
    serviceAccountName: "opensearch"

  securityConfig:
    enabled: false
  singleNode: true

# OpenSearch cluster configuration
openSearchCluster:
  enabled: false
  general:
    version: 3.3.0
    additionalConfig:
      pluginsSecurityDisabled: "true"

  dashboard:
    enabled: true
    replicas: 1
    version: 3.3.0

  nodePools:
    data:
      replicas: 2
      diskSize: 1Gi
      resources:
        limits:
          cpu: 1000m
          memory: 1Gi
        requests:
          cpu: 100m
          memory: 700Mi
    master:
      replicas: 0
      diskSize: 1Gi
      resources:
        limits:
          cpu: 1000m
          memory: 1Gi
        requests:
          cpu: 100m
          memory: 512Mi

  # Secrets
  adminUsername: admin
  adminUserPassword: admin
  internalUsers: |
    # This is the internal user database
    # The hash value is a bcrypt hash and can be generated with plugin/tools/hash.sh

    _meta:
      type: "internalusers"
      config_version: 2

    admin:
      hash: "%s"
      reserved: true
      backend_roles:
      - "admin"
      description: "Admin user"

openSearchClusterSetup:
  image:
    repository: ghcr.io/openchoreo/init-observability-opensearch
    tag: ""

# Customizing OpenSearch Dashboards configurations
openSearchDashboards:
  enabled: true

  config:
    disableSecurity: "true"

  extraEnvs:
  - name: DISABLE_SECURITY_DASHBOARDS_PLUGIN
    value: "true"

  fullnameOverride: "opensearch-dashboards"
  image:
    tag: "3.3.0"
  opensearchHosts: "http://opensearch:9200"
  replicas: 1

# OpenChoreo Observer Service Configuration
observer:
  replicas: 1

  image:
    repository: ghcr.io/openchoreo/observer
    tag: ""  # If no value is set, use Chart.AppVersion
    pullPolicy: IfNotPresent

  service:
    type: ClusterIP
    port: 8080

  logLevel: info

  resources:
    limits:
      cpu: 500m
      memory: 256Mi
    requests:
      cpu: 100m
      memory: 128Mi

# Prometheus configuration
prometheus:
  # Use public registries instead of ACR for Kind deployment
  global:
    imageRegistry: ""
    imagePullSecrets: []
  
  # Disable features not needed for local development
  grafana:
    enabled: false
  
  # Alertmanager configuration
  alertmanager:
    enabled: false
    alertmanagerSpec:
      # Remove topology constraints for Kind
      topologySpreadConstraints: []
      # Use Kind storage class
      storageSpec:
        volumeClaimTemplate:
          spec:
            storageClassName: standard
            accessModes:
              - ReadWriteOnce
            resources:
              requests:
                storage: 2Gi
    
  # Basic Kubernetes monitoring
  kubeApiServer:
    enabled: false
  kubelet:
    enabled: true
  kubeControllerManager:
    enabled: false
  coreDns:
    enabled: false
  kubeEtcd:
    enabled: false
  kubeStateMetrics:
    enabled: true
  kubeScheduler:
    enabled: false
  kubeProxy:
    enabled: false
  nodeExporter:
    enabled: false
    
  # Prometheus Operator configuration
  prometheusOperator:
    kubeletService:
      enabled: false
  
  # Prometheus instance configuration
  prometheus:
    prometheusSpec:
      # Remove topology constraints for Kind
      topologySpreadConstraints: []
      # Use Kind storage class
      storageSpec:
        volumeClaimTemplate:
          spec:
            storageClassName: standard
            accessModes:
              - ReadWriteOnce
            resources:
              requests:
                storage: 5Gi
  
  # Kube-state-metrics configuration for Kind
  kube-state-metrics:
    # Remove topology constraints for Kind
    topologySpreadConstraints: []
    # Enable Choreo pod labels as metrics
    metricLabelsAllowlist:
      - "pods=[component-name,environment-name,organization-name,project-name]"
    # Ensure kube_pod_labels metric is collected
    metricAllowlist:
      - kube_pod_labels
      - kube_pod_info
      - kube_pod_status_phase
      - kube_pod_container_resource_requests
      - kube_pod_container_resource_limits
  
