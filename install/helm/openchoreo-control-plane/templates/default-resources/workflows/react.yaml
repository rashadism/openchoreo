apiVersion: openchoreo.dev/v1alpha1
kind: Workflow
metadata:
  name: react
  namespace: default
  annotations:
    openchoreo.dev/description: "Build workflow for React web applications"
spec:
  schema:
    repository:
      url: string | description="Git repository URL"
      revision:
        branch: string | default=main description="Git branch to checkout"
        commit: string | default="" description="Git commit SHA or reference (empty for latest on branch)"
      appPath: string | default=. description="Path to the React application directory within the repository"
    nodeVersion: string | default="18" enum=16,18,20,22 description="Node.js version to use for building the React application"

  # Rendered resource
  resource:
    apiVersion: argoproj.io/v1alpha1
    kind: Workflow
    metadata:
      name: ${ctx.workflowRunName}
      namespace: openchoreo-ci-${ctx.orgName}
    spec:
      arguments:
        parameters:
          - name: component-name
            value: ${ctx.componentName}
          - name: project-name
            value: ${ctx.projectName}
          # Parameters from schema (developer-facing)
          - name: git-repo
            value: ${schema.repository.url}
          - name: branch
            value: ${schema.repository.revision.branch}
          - name: commit
            value: ${schema.repository.revision.commit}
          - name: app-path
            value: ${schema.repository.appPath}
          - name: node-version
            value: ${schema.nodeVersion}
          - name: image-name
            value: ${ctx.projectName}-${ctx.componentName}
          - name: image-tag
            value: v1
      serviceAccountName: workflow-sa
      workflowTemplateRef:
        clusterScope: true
        name: react
