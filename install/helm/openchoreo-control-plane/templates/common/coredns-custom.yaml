{{- if .Values.k3d.dnsRewrite.enabled }}
---
# CoreDNS custom hosts for multi-cluster DNS resolution
# This ConfigMap provides DNS rewrites for control plane components to reach observer
# Maps observer hostname to host.k3d.internal for cross-cluster communication
apiVersion: v1
kind: ConfigMap
metadata:
  name: coredns-custom
  namespace: kube-system
  labels:
    {{- include "openchoreo-control-plane.labels" . | nindent 4 }}
    app.kubernetes.io/component: dns-rewrite
data:
  observer-services.override: |
    # Rewrite control plane service hostnames to use host.k3d.internal
    # This allows observer to reach control plane services (thunder, api, etc.)
    # Matches: thunder.openchoreo.localhost, api.openchoreo.localhost, openchoreo.localhost, observer.openchoreo.localhost
    rewrite stop {
      name regex (thunder|api|observer)\.openchoreo\.localhost host.k3d.internal
      answer auto
    }
{{- end }}
