apiVersion: k3d.io/v1alpha5
kind: Simple
metadata:
  name: openchoreo-bp
image: rancher/k3s:v1.32.9-k3s1
servers: 1
agents: 0
kubeAPI:
  hostPort: "6552"
# Build Plane uses port range 10xxx
ports:
  # Argo Workflows UI for development testing
  - port: 10081:10081
    nodeFilters:
      - loadbalancer
  # Container Registry for storing built images
  - port: 10082:10082
    nodeFilters:
      - loadbalancer
options:
  k3s:
    extraArgs:
      # Add host.k3d.internal to API server TLS certificate SANs.
      # This allows Control Plane pods to securely access the Build Plane API server
      # via host.k3d.internal:6552 without TLS certificate verification errors.
      - arg: "--tls-san=host.k3d.internal"
        nodeFilters:
          - server:*
      # Disable Traefik ingress controller
      - arg: "--disable=traefik"
        nodeFilters:
          - server:*
