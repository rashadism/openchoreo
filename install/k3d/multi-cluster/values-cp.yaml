# Helm values for OpenChoreo Control Plane in k3d multi-cluster setup
# Note: devMode adds :8080 to URLs (k3d port mapping), disables HTTPS

global:
  baseDomain: openchoreo.localhost
  # Port suffix for URLs (k3d maps host:8080 -> container:80)
  port: ":8080"

# Cluster Gateway configuration for agent-based communication
# Exposes the cluster gateway for remote data/build plane agents to connect
# Note: For k3d, we use Traefik IngressRouteTCP for TLS passthrough on shared port 8443
# Alternative: Add dedicated port mapping in k3d config (requires cluster recreation)
clusterGateway:
  enabled: true
  service:
    type: ClusterIP
    port: 8443
  tlsRoute:
    enabled: true
    hosts:
      - host: cluster-gateway.openchoreo.localhost
        paths:
          - path: /
            pathType: Prefix
  tls:
    enabled: true  # mTLS for secure agent communication
    issuerRef:
      kind: Issuer
      name: cluster-gateway-server-issuer  # CA issuer for server certificates
    dnsNames:
      - cluster-gateway.openchoreo-control-plane.svc
      - cluster-gateway.openchoreo-control-plane.svc.cluster.local
      - cluster-gateway.openchoreo.localhost  # External hostname for multi-cluster access

# Controller Manager cluster gateway configuration
# Enables controllers to communicate with data/build planes via cluster gateway
# Uses internal service DNS (controller runs inside the cluster)
controllerManager:
  clusterGateway:
    enabled: true
    # Use internal service DNS - controller manager runs inside the control plane cluster
    url: https://cluster-gateway.openchoreo-control-plane.svc.cluster.local:8443

thunder:
  configuration:
    server:
      publicUrl: "http://thunder.openchoreo.localhost:8080"
    gateClient:
      hostname: "thunder.openchoreo.localhost"
      port: 8080
      scheme: "http"

gateway:
  # Enable gateway
  enabled: true

  # Envoy - enabled by default for traffic routing
  envoy:
    enabled: true
    # Mount /tmp as emptyDir volume to fix Envoy temporary file creation issues
    # Enable this if gateway pods crash with "Failed to create temporary file" errors
    # Common on: macOS with Docker Desktop/Colima with Rosetta enabled.
    # Ref: https://github.com/kgateway-dev/kgateway/issues/9800
    mountTmpVolume: true
