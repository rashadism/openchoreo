# OpenChoreo Helm Values for Development Installation
# This file contains configuration for installing OpenChoreo components in a kind cluster

# Controller Manager configuration
controllerManager:
  image:
    repository: ghcr.io/openchoreo/controller
    tag: dev
    pullPolicy: IfNotPresent
  # Disable AppArmor for local development (not supported on macOS/Kind)
  containerSecurityContext:
    appArmorProfile:
      type: Unconfined

# OpenChoreo API configuration
openchoreoApi:
  jwt:
    disabled: true
    issuer: thunder
    jwksUrl: http://openchoreo-asgardeo-thunder:8090/oauth2/jwks
  image:
    repository: ghcr.io/openchoreo/openchoreo-api
    tag: dev
    pullPolicy: IfNotPresent
  # Disable AppArmor for local development (not supported on macOS/Kind)
  containerSecurityContext:
    appArmorProfile:
      type: Unconfined
  ingress:
    enabled: true
    ingressClassName: cilium
    hosts:
      - host: api.openchoreo.localhost
        paths:
          - path: /
            pathType: Prefix

# Backstage UI configuration
backstage:
  image:
    repository: ghcr.io/openchoreo/openchoreo-ui
    tag: dev
    pullPolicy: IfNotPresent
  # Disable AppArmor for local development (not supported on macOS/Kind)
  containerSecurityContext:
    appArmorProfile:
      type: Unconfined
  ingress:
    enabled: true
    ingressClassName: cilium
    hosts:
      - host: openchoreo.localhost
        paths:
          - path: /
            pathType: Prefix
  # Backstage base URL (externally accessible URL via ingress)
  baseUrl: "http://openchoreo.localhost"
  # OAuth authorization endpoint (must be browser-accessible for OAuth redirect)
  auth:
    authorizationUrl: "http://sts.openchoreo.localhost/oauth2/authorize"
  # Note: thunder.baseUrl and auth.tokenUrl use default K8s service URLs (not overridden)
asgardeoThunder:
  env:
    - name: ENABLE_HTTPS
      value: "false"
    - name: PORT
      value: "8090"
    - name: HOST
      value: "0.0.0.0"
  config:
    server:
      hostname: "0.0.0.0"
      port: 8090
      httpOnly: true
    gateClient:
      hostname: sts.openchoreo.localhost
      port: 80
      scheme: http
    oauth:
      jwt:
        issuer: "thunder"
  runtimeConfig:
    client:
      base: "/signin"
    server:
      hostname: "sts.openchoreo.localhost"
      port: 80
      httpOnly: true
  ingress:
    enabled: true
    ingressClassName: cilium
    annotations: {}
    hosts:
      - host: sts.openchoreo.localhost
        paths:
          - path: /
            pathType: Prefix
            port: 8090
  backstagePortal:
    redirectUrls:
      - "http://localhost:7007/api/auth/default-idp/handler/frame"
      - "http://openchoreo.localhost/api/auth/default-idp/handler/frame"
    clientSecret: backstage-portal-secret
