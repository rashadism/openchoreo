---
apiVersion: apiextensions.k8s.io/v1
kind: CustomResourceDefinition
metadata:
  annotations:
    controller-gen.kubebuilder.io/version: v0.16.4
  name: observabilityalertsnotificationchannels.openchoreo.dev
spec:
  group: openchoreo.dev
  names:
    kind: ObservabilityAlertsNotificationChannel
    listKind: ObservabilityAlertsNotificationChannelList
    plural: observabilityalertsnotificationchannels
    singular: observabilityalertsnotificationchannel
  scope: Namespaced
  versions:
  - additionalPrinterColumns:
    - jsonPath: .spec.type
      name: Type
      type: string
    - jsonPath: .metadata.creationTimestamp
      name: Age
      type: date
    - jsonPath: .status.notificationCount
      name: Notifications
      type: integer
    name: v1alpha1
    schema:
      openAPIV3Schema:
        description: |-
          ObservabilityAlertsNotificationChannel is the Schema for the observabilityalertsnotificationchannels API.
          It defines a channel for sending alert notifications. Currently email and webhook notifications are supported.
        properties:
          apiVersion:
            description: |-
              APIVersion defines the versioned schema of this representation of an object.
              Servers should convert recognized schemas to the latest internal value, and
              may reject unrecognized values.
              More info: https://git.k8s.io/community/contributors/devel/sig-architecture/api-conventions.md#resources
            type: string
          kind:
            description: |-
              Kind is a string value representing the REST resource this object represents.
              Servers may infer this from the endpoint the client submits requests to.
              Cannot be updated.
              In CamelCase.
              More info: https://git.k8s.io/community/contributors/devel/sig-architecture/api-conventions.md#types-kinds
            type: string
          metadata:
            type: object
          spec:
            description: ObservabilityAlertsNotificationChannelSpec defines the desired
              state of ObservabilityAlertsNotificationChannel.
            properties:
              emailConfig:
                description: |-
                  EmailConfig contains the email notification channel configuration
                  Required when type is "email"
                properties:
                  from:
                    description: |-
                      From is the sender email address
                      Required when type is "email"
                    type: string
                  smtp:
                    description: |-
                      SMTP configuration for sending emails
                      Required when type is "email"
                    properties:
                      auth:
                        description: Auth defines SMTP authentication credentials
                        properties:
                          password:
                            description: |-
                              Password for SMTP authentication
                              Provided via secret reference (TODO: Support inline password)
                            properties:
                              secretKeyRef:
                                description: SecretKeyRef references a specific key
                                  in a Kubernetes secret
                                properties:
                                  key:
                                    type: string
                                  name:
                                    type: string
                                required:
                                - key
                                - name
                                type: object
                            type: object
                          username:
                            description: |-
                              Username for SMTP authentication
                              Provided via secret reference (TODO: Support inline username)
                            properties:
                              secretKeyRef:
                                description: SecretKeyRef references a specific key
                                  in a Kubernetes secret
                                properties:
                                  key:
                                    type: string
                                  name:
                                    type: string
                                required:
                                - key
                                - name
                                type: object
                            type: object
                        required:
                        - password
                        - username
                        type: object
                      host:
                        description: |-
                          Host is the SMTP server hostname
                          Required when type is "email"
                        type: string
                      port:
                        description: |-
                          Port is the SMTP server port
                          Required when type is "email"
                        format: int32
                        maximum: 65535
                        minimum: 1
                        type: integer
                      tls:
                        description: TLS configuration
                        properties:
                          insecureSkipVerify:
                            default: false
                            description: InsecureSkipVerify skips TLS certificate
                              verification (not recommended for production)
                            type: boolean
                        required:
                        - insecureSkipVerify
                        type: object
                    required:
                    - auth
                    - host
                    - port
                    - tls
                    type: object
                  template:
                    description: Template defines the email template using CEL expressions
                    properties:
                      body:
                        description: |-
                          Body is the email body template using CEL expressions
                          Example: "Alert: ${alert.name} triggered at ${alert.startsAt}.\nSummary: ${alert.description}"
                        type: string
                      subject:
                        description: |-
                          Subject is the email subject line template using CEL expressions
                          Example: "[${alert.severity}] - ${alert.name} Triggered"
                        type: string
                    required:
                    - body
                    - subject
                    type: object
                  to:
                    description: |-
                      To is the list of recipient email addresses
                      Required when type is "email"
                    items:
                      type: string
                    minItems: 1
                    type: array
                required:
                - from
                - smtp
                - template
                - to
                type: object
              environment:
                description: Environment is the name of the openchoreo environment
                  this notification channel belongs to
                type: string
                x-kubernetes-validations:
                - message: spec.environment is immutable
                  rule: self == oldSelf
              isEnvDefault:
                default: false
                description: |-
                  IsEnvDefault indicates if this is the default notification channel for the environment
                  There can be only one default notification channel for an environment
                  First notification channel created for an environment will be the default unless otherwise specified
                type: boolean
              type:
                description: |-
                  Type specifies the type of notification channel
                  Currently "email" and "webhook" are supported
                enum:
                - email
                - webhook
                type: string
              webhookConfig:
                description: |-
                  WebhookConfig contains the webhook notification channel configuration
                  Required when type is "webhook"
                properties:
                  headers:
                    additionalProperties:
                      description: WebhookHeaderValue defines a header value that
                        can be provided inline or via secret reference
                      properties:
                        value:
                          description: |-
                            Value is the inline header value
                            Mutually exclusive with valueFrom
                          type: string
                        valueFrom:
                          description: |-
                            ValueFrom references a secret containing the header value
                            Mutually exclusive with value
                          properties:
                            secretKeyRef:
                              description: SecretKeyRef references a specific key
                                in a Kubernetes secret
                              properties:
                                key:
                                  type: string
                                name:
                                  type: string
                              required:
                              - key
                              - name
                              type: object
                          type: object
                      type: object
                      x-kubernetes-validations:
                      - message: exactly one of value or valueFrom must be set
                        rule: has(self.value) != has(self.valueFrom)
                    description: |-
                      Headers are optional HTTP headers to include in the webhook request
                      Headers can be provided inline or via secret references
                    type: object
                  payloadTemplate:
                    description: |-
                      PayloadTemplate is an optional JSON payload template using CEL expressions
                      If not provided, the raw alertDetails object will be sent as JSON
                      CEL expressions use ${...} syntax and have access to alert fields:
                      - ${alert.ruleName}, ${alert.description}, ${alert.severity}, ${alert.value}, etc.
                      Example for Slack: {"text": "Alert: ${alert.ruleName}", "blocks": [...]}
                    type: string
                  url:
                    description: |-
                      URL is the webhook endpoint URL where alerts will be sent
                      Required when type is "webhook"
                    format: uri
                    type: string
                required:
                - url
                type: object
            required:
            - environment
            - type
            type: object
            x-kubernetes-validations:
            - message: emailConfig is required when type is email
              rule: 'self.type == ''email'' ? has(self.emailConfig) : true'
            - message: webhookConfig is required when type is webhook
              rule: 'self.type == ''webhook'' ? has(self.webhookConfig) : true'
          status:
            description: ObservabilityAlertsNotificationChannelStatus defines the
              observed state of ObservabilityAlertsNotificationChannel.
            type: object
        type: object
    served: true
    storage: true
    subresources:
      status: {}
