[request_definition]
# sub: group, service account etc
# hierarchical resource path (e.g., "ns/acme/project/p1/component/c1")
# act: action string (e.g., "component:create", "deployment:read")
# ctx: context JSON
r = sub, resource, act, ctx

[policy_definition]
# sub: subject
# resource: resource prefix for hierarchical matching
# role: role name
# role_ns: "*" for cluster roles, namespace name for namespace-scoped roles
# eft: allow / deny
# ctx: context JSON
# binding_name: name of the AuthzRoleBinding or AuthzClusterRoleBinding (metadata only, not used in matcher)
p = sub, resource, role, role_ns, eft, ctx, binding_name

[role_definition]
# g: role to action mapping with namespace/domain support
# Format: g, <role>, <action>, <namespace>
# For cluster roles: g, <role>, <action>, "*"
# For namespace roles: g, <role>, <action>, <namespace>
g = _, _, _

[policy_effect]
e = some(where (p.eft == allow)) && !some(where (p.eft == deny))

[matchers]
m = r.sub == p.sub && resourceMatch(r.resource, p.resource) && g(p.role, r.act, p.role_ns) && ctxMatch(r.ctx, p.ctx)
