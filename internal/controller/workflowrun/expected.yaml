apiVersion: argoproj.io/v1alpha1
kind: Workflow
metadata:
  name: checkout-service-build-01-abc123
  namespace: openchoreo-ci-default
  labels:
    openchoreo.dev/project: backend-services
    openchoreo.dev/component: checkout-service
    openchoreo.dev/workflow: checkout-service-build-01
spec:
  arguments:
    parameters:
      # Developer parameters (from schema)
      - name: repo-url
        value: https://github.com/myorg/checkout-service.git
      - name: branch
        value: release/v2
      - name: commit
        value: a1b2c3d
      - name: app-path
        value: ./src
      - name: version
        value: [1, 2, 3]
      - name: test-mode
        value: integration
      - name: credentials-ref
        value: checkout-repo-credentials-dev
      - name: command
        value: ["npm", "run", "build"]
      - name: args
        value: ["--production", "--verbose"]
      - name: cpu-cores
        value: 2
      - name: memory-gb
        value: 4
      - name: timeout
        value: 45m
      - name: cache-enabled
        value: true
      - name: cache-paths
        value: ["/root/.npm", "/root/.cache"]
      - name: max-retries
        value: 5
      - name: max-duration-minutes
        value: 90
      # Fixed PE parameters (from WorkflowDefinition/ComponentTypeDefinition)
      - name: builder-image
        value: gcr.io/buildpacks/builder:v1
      - name: registry-url
        value: gcr.io/openchoreo-dev/images
      - name: security-scan-enabled
        value: false
      - name: build-timeout
        value: 45m

      # OpenChoreo context parameters (injected by controller)
      - name: project-name
        value: backend-services
      - name: component-name
        value: checkout-service

  # From WorkflowDefinition
  serviceAccountName: choreo-build-bot

  # Reference to the Argo Workflow template
  workflowTemplateRef:
    clusterScope: true
    name: google-cloud-buildpacks