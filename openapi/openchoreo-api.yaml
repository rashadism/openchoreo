# Copyright 2025 The OpenChoreo Authors
# SPDX-License-Identifier: Apache-2.0

openapi: 3.0.3
info:
  title: OpenChoreo API
  version: 1.0.0
  description: |
    REST API for OpenChoreo Internal Developer Platform.

    OpenChoreo provides Kubernetes-native abstractions for developers and platform engineers,
    implementing a multi-plane architecture with control plane and data plane separation.
  contact:
    name: OpenChoreo
    url: https://github.com/openchoreo/openchoreo
  license:
    name: Apache 2.0
    url: https://www.apache.org/licenses/LICENSE-2.0

servers:
  - url: http://localhost:8080
    description: Local development

# Default security - JWT Bearer token required
# Individual endpoints can override with `security: []` for public access
security:
  - bearerAuth: []

tags:
  - name: Operations
    description: Health, readiness, and version endpoints
  - name: Organizations
    description: Organization management
  - name: Projects
    description: Project management within organizations
  - name: Components
    description: Component management within projects
  - name: Environments
    description: Environment management within organizations
  - name: DataPlanes
    description: DataPlane management for workload deployment targets
  - name: BuildPlanes
    description: BuildPlane management for CI/CD build infrastructure
  - name: ObservabilityPlanes
    description: ObservabilityPlane management for monitoring and logging
  - name: ComponentTypes
    description: ComponentType templates defined by platform engineers
  - name: Traits
    description: Trait templates for composable cross-cutting concerns
  - name: Workflows
    description: Generic workflow templates
  - name: ComponentWorkflows
    description: Component-specific workflow templates and runs
  - name: Authorization
    description: Role-based access control and authorization management
  - name: Webhooks
    description: Git provider webhook handlers
  - name: Resources
    description: Generic resource apply and delete operations
  - name: SecretReferences
    description: Secret reference management
  - name: Workloads
    description: Workload source code definitions
  - name: DeploymentPipelines
    description: Deployment pipeline management

paths:
  # =============================================================================
  # Public Endpoints (No Authentication Required)
  # =============================================================================

  /health:
    get:
      operationId: getHealth
      summary: Health check
      description: Returns OK if the server is healthy. Used for liveness probes.
      tags: [Operations]
      security: []
      responses:
        '200':
          description: Server is healthy
          content:
            text/plain:
              schema:
                type: string
                example: OK

  /ready:
    get:
      operationId: getReady
      summary: Readiness check
      description: Returns Ready if the server is ready to accept requests. Used for readiness probes.
      tags: [Operations]
      security: []
      responses:
        '200':
          description: Server is ready
          content:
            text/plain:
              schema:
                type: string
                example: Ready

  /version:
    get:
      operationId: getVersion
      summary: Get server version
      description: Returns version information about the API server.
      tags: [Operations]
      security: []
      responses:
        '200':
          description: Version information
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/VersionResponse'

  /openapi.json:
    get:
      operationId: getOpenAPISpec
      summary: Get OpenAPI specification
      description: Returns the OpenAPI 3.0 specification for this API in JSON format.
      tags: [Operations]
      security: []
      responses:
        '200':
          description: OpenAPI specification
          content:
            application/json:
              schema:
                type: object
                description: OpenAPI 3.0 specification document

  /.well-known/oauth-protected-resource:
    get:
      operationId: getOAuthProtectedResourceMetadata
      summary: Get OAuth protected resource metadata
      description: |
        Returns OAuth 2.0 protected resource metadata as defined in RFC 9728.
        Used by MCP clients to discover authorization server information.
      tags: [Operations]
      security: []
      responses:
        '200':
          description: OAuth protected resource metadata
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/OAuthProtectedResourceMetadata'

  /api/v1/oidc-config:
    get:
      operationId: getOidcConfig
      summary: Get OIDC configuration for CLI authentication
      description: |
        Returns OIDC configuration for CLI clients to discover authorization
        and token endpoints. Used during initial CLI authentication setup.
      tags: [Operations]
      security: []
      responses:
        '200':
          description: OIDC configuration
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/OidcConfig'

  # =============================================================================
  # Organization Endpoints
  # =============================================================================

  /api/v1/orgs:
    get:
      operationId: listOrganizations
      summary: List organizations
      description: Returns a paginated list of organizations the user has access to.
      tags: [Organizations]
      parameters:
        - $ref: '#/components/parameters/LimitParam'
        - $ref: '#/components/parameters/CursorParam'
      responses:
        '200':
          description: List of organizations
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/OrganizationList'
        '401':
          $ref: '#/components/responses/Unauthorized'
        '403':
          $ref: '#/components/responses/Forbidden'
        '500':
          $ref: '#/components/responses/InternalError'

  /api/v1/orgs/{orgName}:
    get:
      operationId: getOrganization
      summary: Get organization
      description: Returns details of a specific organization.
      tags: [Organizations]
      parameters:
        - $ref: '#/components/parameters/OrgNameParam'
      responses:
        '200':
          description: Organization details
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Organization'
        '401':
          $ref: '#/components/responses/Unauthorized'
        '403':
          $ref: '#/components/responses/Forbidden'
        '404':
          $ref: '#/components/responses/NotFound'
        '500':
          $ref: '#/components/responses/InternalError'

  # =============================================================================
  # Project Endpoints
  # =============================================================================

  /api/v1/orgs/{orgName}/projects:
    get:
      operationId: listProjects
      summary: List projects
      description: Returns a paginated list of projects within an organization.
      tags: [Projects]
      parameters:
        - $ref: '#/components/parameters/OrgNameParam'
        - $ref: '#/components/parameters/LimitParam'
        - $ref: '#/components/parameters/CursorParam'
      responses:
        '200':
          description: List of projects
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ProjectList'
        '401':
          $ref: '#/components/responses/Unauthorized'
        '403':
          $ref: '#/components/responses/Forbidden'
        '404':
          $ref: '#/components/responses/NotFound'
        '500':
          $ref: '#/components/responses/InternalError'

    post:
      operationId: createProject
      summary: Create project
      description: Creates a new project within an organization.
      tags: [Projects]
      parameters:
        - $ref: '#/components/parameters/OrgNameParam'
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/CreateProjectRequest'
      responses:
        '201':
          description: Project created successfully
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Project'
        '400':
          $ref: '#/components/responses/BadRequest'
        '401':
          $ref: '#/components/responses/Unauthorized'
        '403':
          $ref: '#/components/responses/Forbidden'
        '409':
          $ref: '#/components/responses/Conflict'
        '500':
          $ref: '#/components/responses/InternalError'

  /api/v1/orgs/{orgName}/projects/{projectName}:
    get:
      operationId: getProject
      summary: Get project
      description: Returns details of a specific project.
      tags: [Projects]
      parameters:
        - $ref: '#/components/parameters/OrgNameParam'
        - $ref: '#/components/parameters/ProjectNameParam'
      responses:
        '200':
          description: Project details
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Project'
        '401':
          $ref: '#/components/responses/Unauthorized'
        '403':
          $ref: '#/components/responses/Forbidden'
        '404':
          $ref: '#/components/responses/NotFound'
        '500':
          $ref: '#/components/responses/InternalError'

  # =============================================================================
  # Component Endpoints
  # =============================================================================

  /api/v1/orgs/{orgName}/projects/{projectName}/components:
    get:
      operationId: listComponents
      summary: List components
      description: Returns a paginated list of components within a project.
      tags: [Components]
      parameters:
        - $ref: '#/components/parameters/OrgNameParam'
        - $ref: '#/components/parameters/ProjectNameParam'
        - $ref: '#/components/parameters/LimitParam'
        - $ref: '#/components/parameters/CursorParam'
      responses:
        '200':
          description: List of components
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ComponentList'
        '401':
          $ref: '#/components/responses/Unauthorized'
        '403':
          $ref: '#/components/responses/Forbidden'
        '404':
          $ref: '#/components/responses/NotFound'
        '500':
          $ref: '#/components/responses/InternalError'

    post:
      operationId: createComponent
      summary: Create component
      description: Creates a new component within a project.
      tags: [Components]
      parameters:
        - $ref: '#/components/parameters/OrgNameParam'
        - $ref: '#/components/parameters/ProjectNameParam'
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/CreateComponentRequest'
      responses:
        '201':
          description: Component created successfully
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Component'
        '400':
          $ref: '#/components/responses/BadRequest'
        '401':
          $ref: '#/components/responses/Unauthorized'
        '403':
          $ref: '#/components/responses/Forbidden'
        '404':
          $ref: '#/components/responses/NotFound'
        '409':
          $ref: '#/components/responses/Conflict'
        '500':
          $ref: '#/components/responses/InternalError'

  # =============================================================================
  # Environment Endpoints
  # =============================================================================

  /api/v1/orgs/{orgName}/environments:
    get:
      operationId: listEnvironments
      summary: List environments
      description: Returns a paginated list of environments within an organization.
      tags: [Environments]
      parameters:
        - $ref: '#/components/parameters/OrgNameParam'
        - $ref: '#/components/parameters/LimitParam'
        - $ref: '#/components/parameters/CursorParam'
      responses:
        '200':
          description: List of environments
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/EnvironmentList'
        '401':
          $ref: '#/components/responses/Unauthorized'
        '403':
          $ref: '#/components/responses/Forbidden'
        '500':
          $ref: '#/components/responses/InternalError'

    post:
      operationId: createEnvironment
      summary: Create environment
      description: Creates a new environment within an organization.
      tags: [Environments]
      parameters:
        - $ref: '#/components/parameters/OrgNameParam'
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/CreateEnvironmentRequest'
      responses:
        '201':
          description: Environment created successfully
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Environment'
        '400':
          $ref: '#/components/responses/BadRequest'
        '401':
          $ref: '#/components/responses/Unauthorized'
        '403':
          $ref: '#/components/responses/Forbidden'
        '409':
          $ref: '#/components/responses/Conflict'
        '500':
          $ref: '#/components/responses/InternalError'

  /api/v1/orgs/{orgName}/environments/{envName}:
    get:
      operationId: getEnvironment
      summary: Get environment
      description: Returns details of a specific environment.
      tags: [Environments]
      parameters:
        - $ref: '#/components/parameters/OrgNameParam'
        - $ref: '#/components/parameters/EnvironmentNameParam'
      responses:
        '200':
          description: Environment details
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Environment'
        '401':
          $ref: '#/components/responses/Unauthorized'
        '403':
          $ref: '#/components/responses/Forbidden'
        '404':
          $ref: '#/components/responses/NotFound'
        '500':
          $ref: '#/components/responses/InternalError'

  /api/v1/orgs/{orgName}/environments/{envName}/observer-url:
    get:
      operationId: getEnvironmentObserverURL
      summary: Get environment observer URL
      description: Returns the observer URL for accessing logs and metrics for this environment.
      tags: [Environments]
      parameters:
        - $ref: '#/components/parameters/OrgNameParam'
        - $ref: '#/components/parameters/EnvironmentNameParam'
      responses:
        '200':
          description: Observer URL information
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ObserverURLResponse'
        '401':
          $ref: '#/components/responses/Unauthorized'
        '403':
          $ref: '#/components/responses/Forbidden'
        '404':
          $ref: '#/components/responses/NotFound'
        '500':
          $ref: '#/components/responses/InternalError'

  # =============================================================================
  # DataPlane Endpoints
  # =============================================================================

  /api/v1/orgs/{orgName}/dataplanes:
    get:
      operationId: listDataPlanes
      summary: List data planes
      description: Returns a paginated list of data planes within an organization.
      tags: [DataPlanes]
      parameters:
        - $ref: '#/components/parameters/OrgNameParam'
        - $ref: '#/components/parameters/LimitParam'
        - $ref: '#/components/parameters/CursorParam'
      responses:
        '200':
          description: List of data planes
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/DataPlaneList'
        '401':
          $ref: '#/components/responses/Unauthorized'
        '403':
          $ref: '#/components/responses/Forbidden'
        '500':
          $ref: '#/components/responses/InternalError'

    post:
      operationId: createDataPlane
      summary: Create data plane
      description: Creates a new data plane within an organization.
      tags: [DataPlanes]
      parameters:
        - $ref: '#/components/parameters/OrgNameParam'
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/CreateDataPlaneRequest'
      responses:
        '201':
          description: DataPlane created successfully
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/DataPlane'
        '400':
          $ref: '#/components/responses/BadRequest'
        '401':
          $ref: '#/components/responses/Unauthorized'
        '403':
          $ref: '#/components/responses/Forbidden'
        '409':
          $ref: '#/components/responses/Conflict'
        '500':
          $ref: '#/components/responses/InternalError'

  /api/v1/orgs/{orgName}/dataplanes/{dpName}:
    get:
      operationId: getDataPlane
      summary: Get data plane
      description: Returns details of a specific data plane.
      tags: [DataPlanes]
      parameters:
        - $ref: '#/components/parameters/OrgNameParam'
        - $ref: '#/components/parameters/DataPlaneNameParam'
      responses:
        '200':
          description: DataPlane details
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/DataPlane'
        '401':
          $ref: '#/components/responses/Unauthorized'
        '403':
          $ref: '#/components/responses/Forbidden'
        '404':
          $ref: '#/components/responses/NotFound'
        '500':
          $ref: '#/components/responses/InternalError'

  # =============================================================================
  # BuildPlane Endpoints
  # =============================================================================

  /api/v1/orgs/{orgName}/buildplanes:
    get:
      operationId: listBuildPlanes
      summary: List build planes
      description: Returns a list of build planes within an organization. Typically one per organization.
      tags: [BuildPlanes]
      parameters:
        - $ref: '#/components/parameters/OrgNameParam'
      responses:
        '200':
          description: List of build planes
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/BuildPlaneList'
        '401':
          $ref: '#/components/responses/Unauthorized'
        '403':
          $ref: '#/components/responses/Forbidden'
        '500':
          $ref: '#/components/responses/InternalError'

  # =============================================================================
  # ObservabilityPlane Endpoints
  # =============================================================================

  /api/v1/orgs/{orgName}/observabilityplanes:
    get:
      operationId: listObservabilityPlanes
      summary: List observability planes
      description: Returns a list of observability planes within an organization.
      tags: [ObservabilityPlanes]
      parameters:
        - $ref: '#/components/parameters/OrgNameParam'
      responses:
        '200':
          description: List of observability planes
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ObservabilityPlaneList'
        '401':
          $ref: '#/components/responses/Unauthorized'
        '403':
          $ref: '#/components/responses/Forbidden'
        '500':
          $ref: '#/components/responses/InternalError'

  # =============================================================================
  # ComponentType Endpoints
  # =============================================================================

  /api/v1/orgs/{orgName}/component-types:
    get:
      operationId: listComponentTypes
      summary: List component types
      description: Returns a list of component types available in the organization.
      tags: [ComponentTypes]
      parameters:
        - $ref: '#/components/parameters/OrgNameParam'
        - $ref: '#/components/parameters/LimitParam'
        - $ref: '#/components/parameters/CursorParam'
      responses:
        '200':
          description: List of component types
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ComponentTypeList'
        '401':
          $ref: '#/components/responses/Unauthorized'
        '403':
          $ref: '#/components/responses/Forbidden'
        '500':
          $ref: '#/components/responses/InternalError'

  /api/v1/orgs/{orgName}/component-types/{ctName}/schema:
    get:
      operationId: getComponentTypeSchema
      summary: Get component type schema
      description: Returns the parameter schema for a specific component type.
      tags: [ComponentTypes]
      parameters:
        - $ref: '#/components/parameters/OrgNameParam'
        - $ref: '#/components/parameters/ComponentTypeNameParam'
      responses:
        '200':
          description: Component type schema
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/SchemaResponse'
        '401':
          $ref: '#/components/responses/Unauthorized'
        '403':
          $ref: '#/components/responses/Forbidden'
        '404':
          $ref: '#/components/responses/NotFound'
        '500':
          $ref: '#/components/responses/InternalError'

  # =============================================================================
  # Trait Endpoints
  # =============================================================================

  /api/v1/orgs/{orgName}/traits:
    get:
      operationId: listTraits
      summary: List traits
      description: Returns a list of traits available in the organization.
      tags: [Traits]
      parameters:
        - $ref: '#/components/parameters/OrgNameParam'
        - $ref: '#/components/parameters/LimitParam'
        - $ref: '#/components/parameters/CursorParam'
      responses:
        '200':
          description: List of traits
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/TraitList'
        '401':
          $ref: '#/components/responses/Unauthorized'
        '403':
          $ref: '#/components/responses/Forbidden'
        '500':
          $ref: '#/components/responses/InternalError'

  /api/v1/orgs/{orgName}/traits/{traitName}/schema:
    get:
      operationId: getTraitSchema
      summary: Get trait schema
      description: Returns the parameter schema for a specific trait.
      tags: [Traits]
      parameters:
        - $ref: '#/components/parameters/OrgNameParam'
        - $ref: '#/components/parameters/TraitNameParam'
      responses:
        '200':
          description: Trait schema
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/SchemaResponse'
        '401':
          $ref: '#/components/responses/Unauthorized'
        '403':
          $ref: '#/components/responses/Forbidden'
        '404':
          $ref: '#/components/responses/NotFound'
        '500':
          $ref: '#/components/responses/InternalError'

  # =============================================================================
  # Workflow Endpoints (Generic Workflows)
  # =============================================================================

  /api/v1/orgs/{orgName}/workflows:
    get:
      operationId: listWorkflows
      summary: List workflows
      description: Returns a list of generic workflows available in the organization.
      tags: [Workflows]
      parameters:
        - $ref: '#/components/parameters/OrgNameParam'
        - $ref: '#/components/parameters/LimitParam'
        - $ref: '#/components/parameters/CursorParam'
      responses:
        '200':
          description: List of workflows
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/WorkflowList'
        '401':
          $ref: '#/components/responses/Unauthorized'
        '403':
          $ref: '#/components/responses/Forbidden'
        '500':
          $ref: '#/components/responses/InternalError'

  /api/v1/orgs/{orgName}/workflows/{workflowName}/schema:
    get:
      operationId: getWorkflowSchema
      summary: Get workflow schema
      description: Returns the parameter schema for a specific workflow.
      tags: [Workflows]
      parameters:
        - $ref: '#/components/parameters/OrgNameParam'
        - $ref: '#/components/parameters/WorkflowNameParam'
      responses:
        '200':
          description: Workflow schema
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/SchemaResponse'
        '401':
          $ref: '#/components/responses/Unauthorized'
        '403':
          $ref: '#/components/responses/Forbidden'
        '404':
          $ref: '#/components/responses/NotFound'
        '500':
          $ref: '#/components/responses/InternalError'

  # =============================================================================
  # ComponentWorkflow Endpoints
  # =============================================================================

  /api/v1/orgs/{orgName}/component-workflows:
    get:
      operationId: listComponentWorkflows
      summary: List component workflows
      description: Returns a list of component workflow templates available in the organization.
      tags: [ComponentWorkflows]
      parameters:
        - $ref: '#/components/parameters/OrgNameParam'
        - $ref: '#/components/parameters/LimitParam'
        - $ref: '#/components/parameters/CursorParam'
      responses:
        '200':
          description: List of component workflows
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ComponentWorkflowTemplateList'
        '401':
          $ref: '#/components/responses/Unauthorized'
        '403':
          $ref: '#/components/responses/Forbidden'
        '500':
          $ref: '#/components/responses/InternalError'

  /api/v1/orgs/{orgName}/component-workflows/{cwName}/schema:
    get:
      operationId: getComponentWorkflowSchema
      summary: Get component workflow schema
      description: Returns the parameter schema for a specific component workflow.
      tags: [ComponentWorkflows]
      parameters:
        - $ref: '#/components/parameters/OrgNameParam'
        - $ref: '#/components/parameters/ComponentWorkflowNameParam'
      responses:
        '200':
          description: Component workflow schema
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/SchemaResponse'
        '401':
          $ref: '#/components/responses/Unauthorized'
        '403':
          $ref: '#/components/responses/Forbidden'
        '404':
          $ref: '#/components/responses/NotFound'
        '500':
          $ref: '#/components/responses/InternalError'

  /api/v1/orgs/{orgName}/projects/{projectName}/components/{componentName}:
    get:
      operationId: getComponent
      summary: Get component
      description: Returns details of a specific component.
      tags: [Components]
      parameters:
        - $ref: '#/components/parameters/OrgNameParam'
        - $ref: '#/components/parameters/ProjectNameParam'
        - $ref: '#/components/parameters/ComponentNameParam'
        - name: include
          in: query
          required: false
          description: Comma-separated list of additional resources to include
          schema:
            type: string
            example: workload,traits
      responses:
        '200':
          description: Component details
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Component'
        '401':
          $ref: '#/components/responses/Unauthorized'
        '403':
          $ref: '#/components/responses/Forbidden'
        '404':
          $ref: '#/components/responses/NotFound'
        '500':
          $ref: '#/components/responses/InternalError'

    patch:
      operationId: patchComponent
      summary: Patch component
      description: Updates a component with partial data.
      tags: [Components]
      parameters:
        - $ref: '#/components/parameters/OrgNameParam'
        - $ref: '#/components/parameters/ProjectNameParam'
        - $ref: '#/components/parameters/ComponentNameParam'
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/PatchComponentRequest'
      responses:
        '200':
          description: Component updated
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Component'
        '400':
          $ref: '#/components/responses/BadRequest'
        '401':
          $ref: '#/components/responses/Unauthorized'
        '403':
          $ref: '#/components/responses/Forbidden'
        '404':
          $ref: '#/components/responses/NotFound'
        '500':
          $ref: '#/components/responses/InternalError'

  /api/v1/orgs/{orgName}/projects/{projectName}/components/{componentName}/schema:
    get:
      operationId: getComponentSchema
      summary: Get component schema
      description: Returns the combined parameter schema for a component (ComponentType + Traits).
      tags: [Components]
      parameters:
        - $ref: '#/components/parameters/OrgNameParam'
        - $ref: '#/components/parameters/ProjectNameParam'
        - $ref: '#/components/parameters/ComponentNameParam'
      responses:
        '200':
          description: Component schema
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/SchemaResponse'
        '401':
          $ref: '#/components/responses/Unauthorized'
        '403':
          $ref: '#/components/responses/Forbidden'
        '404':
          $ref: '#/components/responses/NotFound'
        '500':
          $ref: '#/components/responses/InternalError'

  /api/v1/orgs/{orgName}/projects/{projectName}/components/{componentName}/traits:
    get:
      operationId: listComponentTraits
      summary: List component traits
      description: Returns the traits attached to a component.
      tags: [Components]
      parameters:
        - $ref: '#/components/parameters/OrgNameParam'
        - $ref: '#/components/parameters/ProjectNameParam'
        - $ref: '#/components/parameters/ComponentNameParam'
      responses:
        '200':
          description: List of component traits
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ComponentTraitList'
        '401':
          $ref: '#/components/responses/Unauthorized'
        '403':
          $ref: '#/components/responses/Forbidden'
        '404':
          $ref: '#/components/responses/NotFound'
        '500':
          $ref: '#/components/responses/InternalError'

    put:
      operationId: updateComponentTraits
      summary: Update component traits
      description: Replaces the traits attached to a component.
      tags: [Components]
      parameters:
        - $ref: '#/components/parameters/OrgNameParam'
        - $ref: '#/components/parameters/ProjectNameParam'
        - $ref: '#/components/parameters/ComponentNameParam'
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/UpdateComponentTraitsRequest'
      responses:
        '200':
          description: Component traits updated
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ComponentTraitList'
        '400':
          $ref: '#/components/responses/BadRequest'
        '401':
          $ref: '#/components/responses/Unauthorized'
        '403':
          $ref: '#/components/responses/Forbidden'
        '404':
          $ref: '#/components/responses/NotFound'
        '500':
          $ref: '#/components/responses/InternalError'

  /api/v1/orgs/{orgName}/projects/{projectName}/components/{componentName}/bindings:
    get:
      operationId: listComponentBindings
      summary: List component bindings
      description: Returns the deployment bindings for a component.
      tags: [Components]
      parameters:
        - $ref: '#/components/parameters/OrgNameParam'
        - $ref: '#/components/parameters/ProjectNameParam'
        - $ref: '#/components/parameters/ComponentNameParam'
        - name: environment
          in: query
          required: false
          description: Filter by environment names
          schema:
            type: array
            items:
              type: string
          style: form
          explode: true
      responses:
        '200':
          description: List of bindings
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/BindingList'
        '401':
          $ref: '#/components/responses/Unauthorized'
        '403':
          $ref: '#/components/responses/Forbidden'
        '404':
          $ref: '#/components/responses/NotFound'
        '500':
          $ref: '#/components/responses/InternalError'

  /api/v1/orgs/{orgName}/projects/{projectName}/components/{componentName}/bindings/{bindingName}:
    patch:
      operationId: updateComponentBinding
      summary: Update component binding
      description: Updates a component's deployment binding.
      tags: [Components]
      parameters:
        - $ref: '#/components/parameters/OrgNameParam'
        - $ref: '#/components/parameters/ProjectNameParam'
        - $ref: '#/components/parameters/ComponentNameParam'
        - $ref: '#/components/parameters/BindingNameParam'
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/UpdateBindingRequest'
      responses:
        '200':
          description: Binding updated
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Binding'
        '400':
          $ref: '#/components/responses/BadRequest'
        '401':
          $ref: '#/components/responses/Unauthorized'
        '403':
          $ref: '#/components/responses/Forbidden'
        '404':
          $ref: '#/components/responses/NotFound'
        '500':
          $ref: '#/components/responses/InternalError'

  /api/v1/orgs/{orgName}/projects/{projectName}/components/{componentName}/component-releases:
    get:
      operationId: listComponentReleases
      summary: List component releases
      description: Returns immutable release snapshots for a component.
      tags: [Components]
      parameters:
        - $ref: '#/components/parameters/OrgNameParam'
        - $ref: '#/components/parameters/ProjectNameParam'
        - $ref: '#/components/parameters/ComponentNameParam'
        - $ref: '#/components/parameters/LimitParam'
        - $ref: '#/components/parameters/CursorParam'
      responses:
        '200':
          description: List of component releases
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ComponentReleaseList'
        '401':
          $ref: '#/components/responses/Unauthorized'
        '403':
          $ref: '#/components/responses/Forbidden'
        '404':
          $ref: '#/components/responses/NotFound'
        '500':
          $ref: '#/components/responses/InternalError'

    post:
      operationId: createComponentRelease
      summary: Create component release
      description: Creates an immutable release snapshot from current component state.
      tags: [Components]
      parameters:
        - $ref: '#/components/parameters/OrgNameParam'
        - $ref: '#/components/parameters/ProjectNameParam'
        - $ref: '#/components/parameters/ComponentNameParam'
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/CreateComponentReleaseRequest'
      responses:
        '201':
          description: Component release created
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ComponentRelease'
        '400':
          $ref: '#/components/responses/BadRequest'
        '401':
          $ref: '#/components/responses/Unauthorized'
        '403':
          $ref: '#/components/responses/Forbidden'
        '404':
          $ref: '#/components/responses/NotFound'
        '500':
          $ref: '#/components/responses/InternalError'

  /api/v1/orgs/{orgName}/projects/{projectName}/components/{componentName}/component-releases/{releaseName}:
    get:
      operationId: getComponentRelease
      summary: Get component release
      description: Returns details of a specific component release.
      tags: [Components]
      parameters:
        - $ref: '#/components/parameters/OrgNameParam'
        - $ref: '#/components/parameters/ProjectNameParam'
        - $ref: '#/components/parameters/ComponentNameParam'
        - $ref: '#/components/parameters/ReleaseNameParam'
      responses:
        '200':
          description: Component release details
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ComponentRelease'
        '401':
          $ref: '#/components/responses/Unauthorized'
        '403':
          $ref: '#/components/responses/Forbidden'
        '404':
          $ref: '#/components/responses/NotFound'
        '500':
          $ref: '#/components/responses/InternalError'

  /api/v1/orgs/{orgName}/projects/{projectName}/components/{componentName}/component-releases/{releaseName}/schema:
    get:
      operationId: getComponentReleaseSchema
      summary: Get component release schema
      description: Returns the parameter schema for a component release.
      tags: [Components]
      parameters:
        - $ref: '#/components/parameters/OrgNameParam'
        - $ref: '#/components/parameters/ProjectNameParam'
        - $ref: '#/components/parameters/ComponentNameParam'
        - $ref: '#/components/parameters/ReleaseNameParam'
      responses:
        '200':
          description: Component release schema
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/SchemaResponse'
        '401':
          $ref: '#/components/responses/Unauthorized'
        '403':
          $ref: '#/components/responses/Forbidden'
        '404':
          $ref: '#/components/responses/NotFound'
        '500':
          $ref: '#/components/responses/InternalError'

  /api/v1/orgs/{orgName}/projects/{projectName}/components/{componentName}/release-bindings:
    get:
      operationId: listReleaseBindings
      summary: List release bindings
      description: Returns environment-specific release bindings for a component.
      tags: [Components]
      parameters:
        - $ref: '#/components/parameters/OrgNameParam'
        - $ref: '#/components/parameters/ProjectNameParam'
        - $ref: '#/components/parameters/ComponentNameParam'
        - name: environment
          in: query
          required: false
          description: Filter by environment names
          schema:
            type: array
            items:
              type: string
          style: form
          explode: true
      responses:
        '200':
          description: List of release bindings
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ReleaseBindingList'
        '401':
          $ref: '#/components/responses/Unauthorized'
        '403':
          $ref: '#/components/responses/Forbidden'
        '404':
          $ref: '#/components/responses/NotFound'
        '500':
          $ref: '#/components/responses/InternalError'

  /api/v1/orgs/{orgName}/projects/{projectName}/components/{componentName}/release-bindings/{bindingName}:
    patch:
      operationId: patchReleaseBinding
      summary: Patch release binding
      description: Updates a release binding with environment-specific overrides.
      tags: [Components]
      parameters:
        - $ref: '#/components/parameters/OrgNameParam'
        - $ref: '#/components/parameters/ProjectNameParam'
        - $ref: '#/components/parameters/ComponentNameParam'
        - $ref: '#/components/parameters/BindingNameParam'
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/PatchReleaseBindingRequest'
      responses:
        '200':
          description: Release binding updated
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ReleaseBinding'
        '400':
          $ref: '#/components/responses/BadRequest'
        '401':
          $ref: '#/components/responses/Unauthorized'
        '403':
          $ref: '#/components/responses/Forbidden'
        '404':
          $ref: '#/components/responses/NotFound'
        '500':
          $ref: '#/components/responses/InternalError'

  /api/v1/orgs/{orgName}/projects/{projectName}/components/{componentName}/environments/{environmentName}/release:
    get:
      operationId: getEnvironmentRelease
      summary: Get environment release
      description: Returns the deployed release for a component in an environment.
      tags: [Components]
      parameters:
        - $ref: '#/components/parameters/OrgNameParam'
        - $ref: '#/components/parameters/ProjectNameParam'
        - $ref: '#/components/parameters/ComponentNameParam'
        - $ref: '#/components/parameters/ComponentEnvironmentNameParam'
      responses:
        '200':
          description: Release details
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Release'
        '401':
          $ref: '#/components/responses/Unauthorized'
        '403':
          $ref: '#/components/responses/Forbidden'
        '404':
          $ref: '#/components/responses/NotFound'
        '500':
          $ref: '#/components/responses/InternalError'

  /api/v1/orgs/{orgName}/projects/{projectName}/components/{componentName}/deploy:
    post:
      operationId: deployRelease
      summary: Deploy release
      description: Deploys a component release to an environment.
      tags: [Components]
      parameters:
        - $ref: '#/components/parameters/OrgNameParam'
        - $ref: '#/components/parameters/ProjectNameParam'
        - $ref: '#/components/parameters/ComponentNameParam'
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/DeployReleaseRequest'
      responses:
        '201':
          description: Release deployed
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ReleaseBinding'
        '400':
          $ref: '#/components/responses/BadRequest'
        '401':
          $ref: '#/components/responses/Unauthorized'
        '403':
          $ref: '#/components/responses/Forbidden'
        '404':
          $ref: '#/components/responses/NotFound'
        '500':
          $ref: '#/components/responses/InternalError'

  /api/v1/orgs/{orgName}/projects/{projectName}/components/{componentName}/promote:
    post:
      operationId: promoteComponent
      summary: Promote component
      description: Promotes a component release from one environment to another.
      tags: [Components]
      parameters:
        - $ref: '#/components/parameters/OrgNameParam'
        - $ref: '#/components/parameters/ProjectNameParam'
        - $ref: '#/components/parameters/ComponentNameParam'
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/PromoteComponentRequest'
      responses:
        '200':
          description: Component promoted
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ReleaseBinding'
        '400':
          $ref: '#/components/responses/BadRequest'
        '401':
          $ref: '#/components/responses/Unauthorized'
        '403':
          $ref: '#/components/responses/Forbidden'
        '404':
          $ref: '#/components/responses/NotFound'
        '500':
          $ref: '#/components/responses/InternalError'

  /api/v1/orgs/{orgName}/projects/{projectName}/components/{componentName}/environments/{environmentName}/observer-url:
    get:
      operationId: getComponentObserverURL
      summary: Get component observer URL
      description: Returns the observer URL for component logs and metrics in an environment.
      tags: [Components]
      parameters:
        - $ref: '#/components/parameters/OrgNameParam'
        - $ref: '#/components/parameters/ProjectNameParam'
        - $ref: '#/components/parameters/ComponentNameParam'
        - $ref: '#/components/parameters/ComponentEnvironmentNameParam'
      responses:
        '200':
          description: Observer URL
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ObserverURLResponse'
        '401':
          $ref: '#/components/responses/Unauthorized'
        '403':
          $ref: '#/components/responses/Forbidden'
        '404':
          $ref: '#/components/responses/NotFound'
        '500':
          $ref: '#/components/responses/InternalError'

  /api/v1/orgs/{orgName}/projects/{projectName}/components/{componentName}/observer-url:
    get:
      operationId: getBuildObserverURL
      summary: Get build observer URL
      description: Returns the observer URL for component build logs.
      tags: [Components]
      parameters:
        - $ref: '#/components/parameters/OrgNameParam'
        - $ref: '#/components/parameters/ProjectNameParam'
        - $ref: '#/components/parameters/ComponentNameParam'
      responses:
        '200':
          description: Observer URL
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ObserverURLResponse'
        '401':
          $ref: '#/components/responses/Unauthorized'
        '403':
          $ref: '#/components/responses/Forbidden'
        '404':
          $ref: '#/components/responses/NotFound'
        '500':
          $ref: '#/components/responses/InternalError'

  /api/v1/orgs/{orgName}/projects/{projectName}/components/{componentName}/workflow-parameters:
    patch:
      operationId: updateComponentWorkflowParameters
      summary: Update component workflow parameters
      description: Updates the workflow parameters for a component.
      tags: [ComponentWorkflows]
      parameters:
        - $ref: '#/components/parameters/OrgNameParam'
        - $ref: '#/components/parameters/ProjectNameParam'
        - $ref: '#/components/parameters/ComponentNameParam'
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/UpdateComponentWorkflowRequest'
      responses:
        '200':
          description: Workflow parameters updated
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Component'
        '400':
          $ref: '#/components/responses/BadRequest'
        '401':
          $ref: '#/components/responses/Unauthorized'
        '403':
          $ref: '#/components/responses/Forbidden'
        '404':
          $ref: '#/components/responses/NotFound'
        '500':
          $ref: '#/components/responses/InternalError'

  /api/v1/orgs/{orgName}/projects/{projectName}/components/{componentName}/workflow-runs:
    get:
      operationId: listComponentWorkflowRuns
      summary: List component workflow runs
      description: Returns a list of workflow runs for a component.
      tags: [ComponentWorkflows]
      parameters:
        - $ref: '#/components/parameters/OrgNameParam'
        - $ref: '#/components/parameters/ProjectNameParam'
        - $ref: '#/components/parameters/ComponentNameParam'
        - $ref: '#/components/parameters/LimitParam'
        - $ref: '#/components/parameters/CursorParam'
      responses:
        '200':
          description: List of workflow runs
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ComponentWorkflowRunList'
        '401':
          $ref: '#/components/responses/Unauthorized'
        '403':
          $ref: '#/components/responses/Forbidden'
        '404':
          $ref: '#/components/responses/NotFound'
        '500':
          $ref: '#/components/responses/InternalError'

    post:
      operationId: createComponentWorkflowRun
      summary: Trigger component workflow run
      description: Triggers a new workflow run (build) for a component.
      tags: [ComponentWorkflows]
      parameters:
        - $ref: '#/components/parameters/OrgNameParam'
        - $ref: '#/components/parameters/ProjectNameParam'
        - $ref: '#/components/parameters/ComponentNameParam'
        - name: commit
          in: query
          required: false
          description: Specific git commit SHA to build (optional)
          schema:
            type: string
            example: abc1234
      responses:
        '201':
          description: Workflow run triggered
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ComponentWorkflowRun'
        '400':
          $ref: '#/components/responses/BadRequest'
        '401':
          $ref: '#/components/responses/Unauthorized'
        '403':
          $ref: '#/components/responses/Forbidden'
        '404':
          $ref: '#/components/responses/NotFound'
        '500':
          $ref: '#/components/responses/InternalError'

  /api/v1/orgs/{orgName}/projects/{projectName}/components/{componentName}/workflow-runs/{runName}:
    get:
      operationId: getComponentWorkflowRun
      summary: Get component workflow run
      description: Returns details of a specific workflow run.
      tags: [ComponentWorkflows]
      parameters:
        - $ref: '#/components/parameters/OrgNameParam'
        - $ref: '#/components/parameters/ProjectNameParam'
        - $ref: '#/components/parameters/ComponentNameParam'
        - $ref: '#/components/parameters/WorkflowRunNameParam'
      responses:
        '200':
          description: Workflow run details
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ComponentWorkflowRun'
        '401':
          $ref: '#/components/responses/Unauthorized'
        '403':
          $ref: '#/components/responses/Forbidden'
        '404':
          $ref: '#/components/responses/NotFound'
        '500':
          $ref: '#/components/responses/InternalError'

  # =============================================================================
  # Authorization Endpoints
  # =============================================================================

  /api/v1/authz/roles:
    get:
      operationId: listRoles
      summary: List roles
      description: Returns all defined authorization roles.
      tags: [Authorization]
      responses:
        '200':
          description: List of roles
          content:
            application/json:
              schema:
                type: array
                items:
                  $ref: '#/components/schemas/Role'
        '401':
          $ref: '#/components/responses/Unauthorized'
        '403':
          $ref: '#/components/responses/Forbidden'
        '500':
          $ref: '#/components/responses/InternalError'

    post:
      operationId: addRole
      summary: Create role
      description: Creates a new authorization role.
      tags: [Authorization]
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/Role'
      responses:
        '201':
          description: Role created successfully
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/MessageResponse'
        '400':
          $ref: '#/components/responses/BadRequest'
        '401':
          $ref: '#/components/responses/Unauthorized'
        '403':
          $ref: '#/components/responses/Forbidden'
        '409':
          $ref: '#/components/responses/Conflict'
        '500':
          $ref: '#/components/responses/InternalError'

  /api/v1/authz/roles/{roleName}:
    get:
      operationId: getRole
      summary: Get role
      description: Returns details of a specific role.
      tags: [Authorization]
      parameters:
        - $ref: '#/components/parameters/RoleNameParam'
      responses:
        '200':
          description: Role details
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Role'
        '401':
          $ref: '#/components/responses/Unauthorized'
        '403':
          $ref: '#/components/responses/Forbidden'
        '404':
          $ref: '#/components/responses/NotFound'
        '500':
          $ref: '#/components/responses/InternalError'

    put:
      operationId: updateRole
      summary: Update role
      description: Updates an existing role's actions.
      tags: [Authorization]
      parameters:
        - $ref: '#/components/parameters/RoleNameParam'
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/UpdateRoleRequest'
      responses:
        '200':
          description: Role updated successfully
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/MessageResponse'
        '400':
          $ref: '#/components/responses/BadRequest'
        '401':
          $ref: '#/components/responses/Unauthorized'
        '403':
          $ref: '#/components/responses/Forbidden'
        '404':
          $ref: '#/components/responses/NotFound'
        '500':
          $ref: '#/components/responses/InternalError'

    delete:
      operationId: removeRole
      summary: Delete role
      description: Deletes a role. Use force=true to also remove associated mappings.
      tags: [Authorization]
      parameters:
        - $ref: '#/components/parameters/RoleNameParam'
        - name: force
          in: query
          required: false
          description: Force deletion and remove all associated role mappings
          schema:
            type: boolean
            default: false
      responses:
        '204':
          description: Role deleted successfully
        '401':
          $ref: '#/components/responses/Unauthorized'
        '403':
          $ref: '#/components/responses/Forbidden'
        '404':
          $ref: '#/components/responses/NotFound'
        '409':
          $ref: '#/components/responses/Conflict'
        '500':
          $ref: '#/components/responses/InternalError'

  /api/v1/authz/role-mappings:
    get:
      operationId: listRoleMappings
      summary: List role mappings
      description: Returns role-entitlement mappings. Filter by role name or entitlement.
      tags: [Authorization]
      parameters:
        - name: role
          in: query
          required: false
          description: Filter by role name
          schema:
            type: string
        - name: claim
          in: query
          required: false
          description: Filter by entitlement claim (requires value parameter)
          schema:
            type: string
        - name: value
          in: query
          required: false
          description: Filter by entitlement value (requires claim parameter)
          schema:
            type: string
      responses:
        '200':
          description: List of role mappings
          content:
            application/json:
              schema:
                type: array
                items:
                  $ref: '#/components/schemas/RoleEntitlementMapping'
        '400':
          $ref: '#/components/responses/BadRequest'
        '401':
          $ref: '#/components/responses/Unauthorized'
        '403':
          $ref: '#/components/responses/Forbidden'
        '500':
          $ref: '#/components/responses/InternalError'

    post:
      operationId: addRoleMapping
      summary: Create role mapping
      description: Creates a new role-entitlement mapping.
      tags: [Authorization]
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/RoleEntitlementMapping'
      responses:
        '201':
          description: Role mapping created successfully
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/MessageResponse'
        '400':
          $ref: '#/components/responses/BadRequest'
        '401':
          $ref: '#/components/responses/Unauthorized'
        '403':
          $ref: '#/components/responses/Forbidden'
        '409':
          $ref: '#/components/responses/Conflict'
        '500':
          $ref: '#/components/responses/InternalError'

  /api/v1/authz/role-mappings/{mappingId}:
    put:
      operationId: updateRoleMapping
      summary: Update role mapping
      description: Updates an existing role-entitlement mapping.
      tags: [Authorization]
      parameters:
        - $ref: '#/components/parameters/MappingIdParam'
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/UpdateRoleMappingRequest'
      responses:
        '200':
          description: Role mapping updated successfully
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/MessageResponse'
        '400':
          $ref: '#/components/responses/BadRequest'
        '401':
          $ref: '#/components/responses/Unauthorized'
        '403':
          $ref: '#/components/responses/Forbidden'
        '404':
          $ref: '#/components/responses/NotFound'
        '409':
          $ref: '#/components/responses/Conflict'
        '500':
          $ref: '#/components/responses/InternalError'

    delete:
      operationId: removeRoleMapping
      summary: Delete role mapping
      description: Deletes a role-entitlement mapping.
      tags: [Authorization]
      parameters:
        - $ref: '#/components/parameters/MappingIdParam'
      responses:
        '204':
          description: Role mapping deleted successfully
        '401':
          $ref: '#/components/responses/Unauthorized'
        '403':
          $ref: '#/components/responses/Forbidden'
        '404':
          $ref: '#/components/responses/NotFound'
        '500':
          $ref: '#/components/responses/InternalError'

  /api/v1/authz/actions:
    get:
      operationId: listActions
      summary: List actions
      description: Returns all defined authorization actions.
      tags: [Authorization]
      responses:
        '200':
          description: List of actions
          content:
            application/json:
              schema:
                type: array
                items:
                  type: string
        '401':
          $ref: '#/components/responses/Unauthorized'
        '403':
          $ref: '#/components/responses/Forbidden'
        '500':
          $ref: '#/components/responses/InternalError'

  /api/v1/authz/evaluate:
    post:
      operationId: evaluate
      summary: Evaluate authorization
      description: Evaluates a single authorization request.
      tags: [Authorization]
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/EvaluateRequest'
      responses:
        '200':
          description: Authorization decision
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Decision'
        '400':
          $ref: '#/components/responses/BadRequest'
        '401':
          $ref: '#/components/responses/Unauthorized'
        '500':
          $ref: '#/components/responses/InternalError'

  /api/v1/authz/batch-evaluate:
    post:
      operationId: batchEvaluate
      summary: Batch evaluate authorization
      description: Evaluates multiple authorization requests in a single call.
      tags: [Authorization]
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/BatchEvaluateRequest'
      responses:
        '200':
          description: Authorization decisions
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/BatchEvaluateResponse'
        '400':
          $ref: '#/components/responses/BadRequest'
        '401':
          $ref: '#/components/responses/Unauthorized'
        '500':
          $ref: '#/components/responses/InternalError'

  /api/v1/authz/profile:
    get:
      operationId: getSubjectProfile
      summary: Get subject profile
      description: Returns the authorization profile for the authenticated subject.
      tags: [Authorization]
      parameters:
        - name: org
          in: query
          required: false
          description: Organization scope
          schema:
            type: string
        - name: project
          in: query
          required: false
          description: Project scope
          schema:
            type: string
        - name: component
          in: query
          required: false
          description: Component scope
          schema:
            type: string
        - name: ou
          in: query
          required: false
          description: Organization units scope
          schema:
            type: array
            items:
              type: string
          style: form
          explode: true
      responses:
        '200':
          description: Subject profile
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/UserCapabilitiesResponse'
        '400':
          $ref: '#/components/responses/BadRequest'
        '401':
          $ref: '#/components/responses/Unauthorized'
        '403':
          $ref: '#/components/responses/Forbidden'
        '500':
          $ref: '#/components/responses/InternalError'

  # =============================================================================
  # User Types Endpoint
  # =============================================================================

  /api/v1/user-types:
    get:
      operationId: listUserTypes
      summary: List user types
      description: Returns the configured user types for authentication and authorization.
      tags: [Authorization]
      responses:
        '200':
          description: List of configured user types
          content:
            application/json:
              schema:
                type: array
                items:
                  $ref: '#/components/schemas/UserTypeConfig'
        '401':
          $ref: '#/components/responses/Unauthorized'
        '500':
          $ref: '#/components/responses/InternalError'

  # =============================================================================
  # Webhook Endpoints
  # =============================================================================

  /api/v1/webhooks/github:
    post:
      operationId: handleGitHubWebhook
      summary: Handle GitHub webhook
      description: Processes incoming GitHub webhook events to trigger builds.
      tags: [Webhooks]
      security: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              description: GitHub webhook payload
              additionalProperties: true
      responses:
        '200':
          description: Webhook processed successfully
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/WebhookEventResponse'
        '400':
          $ref: '#/components/responses/BadRequest'
        '401':
          $ref: '#/components/responses/Unauthorized'
        '500':
          $ref: '#/components/responses/InternalError'

  /api/v1/webhooks/gitlab:
    post:
      operationId: handleGitLabWebhook
      summary: Handle GitLab webhook
      description: Processes incoming GitLab webhook events to trigger builds.
      tags: [Webhooks]
      security: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              description: GitLab webhook payload
              additionalProperties: true
      responses:
        '200':
          description: Webhook processed successfully
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/WebhookEventResponse'
        '400':
          $ref: '#/components/responses/BadRequest'
        '401':
          $ref: '#/components/responses/Unauthorized'
        '500':
          $ref: '#/components/responses/InternalError'

  /api/v1/webhooks/bitbucket:
    post:
      operationId: handleBitbucketWebhook
      summary: Handle Bitbucket webhook
      description: Processes incoming Bitbucket webhook events to trigger builds.
      tags: [Webhooks]
      security: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              description: Bitbucket webhook payload
              additionalProperties: true
      responses:
        '200':
          description: Webhook processed successfully
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/WebhookEventResponse'
        '400':
          $ref: '#/components/responses/BadRequest'
        '401':
          $ref: '#/components/responses/Unauthorized'
        '500':
          $ref: '#/components/responses/InternalError'

  # =============================================================================
  # Resource Apply/Delete Endpoints
  # =============================================================================

  /api/v1/apply:
    post:
      operationId: applyResource
      summary: Apply resource
      description: Applies a Kubernetes resource (like kubectl apply). Creates or updates the resource.
      tags: [Resources]
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/KubernetesResource'
      responses:
        '200':
          description: Resource applied successfully
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ApplyResourceResponse'
        '400':
          $ref: '#/components/responses/BadRequest'
        '401':
          $ref: '#/components/responses/Unauthorized'
        '403':
          $ref: '#/components/responses/Forbidden'
        '500':
          $ref: '#/components/responses/InternalError'

  /api/v1/delete:
    delete:
      operationId: deleteResource
      summary: Delete resource
      description: Deletes a Kubernetes resource (like kubectl delete).
      tags: [Resources]
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/KubernetesResource'
      responses:
        '200':
          description: Resource deleted successfully
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/DeleteResourceResponse'
        '400':
          $ref: '#/components/responses/BadRequest'
        '401':
          $ref: '#/components/responses/Unauthorized'
        '403':
          $ref: '#/components/responses/Forbidden'
        '500':
          $ref: '#/components/responses/InternalError'

  # =============================================================================
  # Secret Reference Endpoints
  # =============================================================================

  /api/v1/orgs/{orgName}/secret-references:
    get:
      operationId: listSecretReferences
      summary: List secret references
      description: Returns a list of secret references within an organization.
      tags: [SecretReferences]
      parameters:
        - $ref: '#/components/parameters/OrgNameParam'
      responses:
        '200':
          description: List of secret references
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/SecretReferenceList'
        '401':
          $ref: '#/components/responses/Unauthorized'
        '403':
          $ref: '#/components/responses/Forbidden'
        '404':
          $ref: '#/components/responses/NotFound'
        '500':
          $ref: '#/components/responses/InternalError'

  # =============================================================================
  # Workload Endpoints
  # =============================================================================

  /api/v1/orgs/{orgName}/projects/{projectName}/components/{componentName}/workloads:
    get:
      operationId: getWorkloads
      summary: Get component workloads
      description: Returns the workload definition for a component.
      tags: [Workloads]
      parameters:
        - $ref: '#/components/parameters/OrgNameParam'
        - $ref: '#/components/parameters/ProjectNameParam'
        - $ref: '#/components/parameters/ComponentNameParam'
      responses:
        '200':
          description: Workload specification
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/WorkloadSpec'
        '401':
          $ref: '#/components/responses/Unauthorized'
        '403':
          $ref: '#/components/responses/Forbidden'
        '404':
          $ref: '#/components/responses/NotFound'
        '500':
          $ref: '#/components/responses/InternalError'

    post:
      operationId: createWorkload
      summary: Create or update workload
      description: Creates or updates the workload definition for a component.
      tags: [Workloads]
      parameters:
        - $ref: '#/components/parameters/OrgNameParam'
        - $ref: '#/components/parameters/ProjectNameParam'
        - $ref: '#/components/parameters/ComponentNameParam'
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/WorkloadSpec'
      responses:
        '201':
          description: Workload created/updated successfully
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/WorkloadSpec'
        '400':
          $ref: '#/components/responses/BadRequest'
        '401':
          $ref: '#/components/responses/Unauthorized'
        '403':
          $ref: '#/components/responses/Forbidden'
        '404':
          $ref: '#/components/responses/NotFound'
        '500':
          $ref: '#/components/responses/InternalError'

  # =============================================================================
  # Deployment Pipeline Endpoints
  # =============================================================================

  /api/v1/orgs/{orgName}/projects/{projectName}/deployment-pipeline:
    get:
      operationId: getProjectDeploymentPipeline
      summary: Get project deployment pipeline
      description: Returns the deployment pipeline for a project.
      tags: [DeploymentPipelines]
      parameters:
        - $ref: '#/components/parameters/OrgNameParam'
        - $ref: '#/components/parameters/ProjectNameParam'
      responses:
        '200':
          description: Deployment pipeline details
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/DeploymentPipeline'
        '401':
          $ref: '#/components/responses/Unauthorized'
        '403':
          $ref: '#/components/responses/Forbidden'
        '404':
          $ref: '#/components/responses/NotFound'
        '500':
          $ref: '#/components/responses/InternalError'

components:
  # ===========================================================================
  # Security Schemes
  # ===========================================================================
  securitySchemes:
    bearerAuth:
      type: http
      scheme: bearer
      bearerFormat: JWT
      description: |
        JWT Bearer token authentication.

        Obtain a token from your identity provider and include it in the
        Authorization header: `Authorization: Bearer <token>`

        The server validates tokens using JWKS from the configured issuer.

  # ===========================================================================
  # Common Parameters
  # ===========================================================================
  parameters:
    OrgNameParam:
      name: orgName
      in: path
      required: true
      description: Organization name
      schema:
        type: string
        example: my-org

    ProjectNameParam:
      name: projectName
      in: path
      required: true
      description: Project name
      schema:
        type: string
        example: my-project

    EnvironmentNameParam:
      name: envName
      in: path
      required: true
      description: Environment name
      schema:
        type: string
        example: dev

    ComponentEnvironmentNameParam:
      name: environmentName
      in: path
      required: true
      description: Environment name for component-scoped operations
      schema:
        type: string
        example: dev

    DataPlaneNameParam:
      name: dpName
      in: path
      required: true
      description: DataPlane name
      schema:
        type: string
        example: default-dataplane

    ComponentTypeNameParam:
      name: ctName
      in: path
      required: true
      description: ComponentType name
      schema:
        type: string
        example: go-service

    TraitNameParam:
      name: traitName
      in: path
      required: true
      description: Trait name
      schema:
        type: string
        example: autoscaler

    WorkflowNameParam:
      name: workflowName
      in: path
      required: true
      description: Workflow name
      schema:
        type: string
        example: database-migration

    ComponentWorkflowNameParam:
      name: cwName
      in: path
      required: true
      description: ComponentWorkflow name
      schema:
        type: string
        example: docker-build

    ComponentNameParam:
      name: componentName
      in: path
      required: true
      description: Component name
      schema:
        type: string
        example: api-service

    WorkflowRunNameParam:
      name: runName
      in: path
      required: true
      description: Workflow run name
      schema:
        type: string
        example: api-service-run-1234

    BindingNameParam:
      name: bindingName
      in: path
      required: true
      description: Binding name
      schema:
        type: string
        example: api-service-dev

    ReleaseNameParam:
      name: releaseName
      in: path
      required: true
      description: Release name
      schema:
        type: string
        example: v1.0.0

    RoleNameParam:
      name: roleName
      in: path
      required: true
      description: Role name
      schema:
        type: string
        example: admin

    MappingIdParam:
      name: mappingId
      in: path
      required: true
      description: Role mapping ID
      schema:
        type: integer
        format: int64
        example: 123

    LimitParam:
      name: limit
      in: query
      required: false
      description: Maximum number of items to return per page
      schema:
        type: integer
        minimum: 1
        maximum: 100
        default: 20

    CursorParam:
      name: cursor
      in: query
      required: false
      description: |
        Opaque pagination cursor from a previous response.
        Pass the `nextCursor` value from pagination metadata to fetch the next page.
      schema:
        type: string

  # ===========================================================================
  # Common Responses
  # ===========================================================================
  responses:
    BadRequest:
      description: Invalid request parameters
      content:
        application/json:
          schema:
            $ref: '#/components/schemas/ErrorResponse'
          example:
            error: "Invalid request: name is required"
            code: BAD_REQUEST
            details:
              - field: name
                message: is required

    Unauthorized:
      description: Authentication required or token invalid
      content:
        application/json:
          schema:
            $ref: '#/components/schemas/ErrorResponse'
          example:
            error: "Authentication required"
            code: UNAUTHORIZED

    Forbidden:
      description: Insufficient permissions to access the resource
      content:
        application/json:
          schema:
            $ref: '#/components/schemas/ErrorResponse'
          example:
            error: "You do not have permission to access this resource"
            code: FORBIDDEN

    NotFound:
      description: Resource not found
      content:
        application/json:
          schema:
            $ref: '#/components/schemas/ErrorResponse'
          example:
            error: "Project 'my-project' not found"
            code: NOT_FOUND

    Conflict:
      description: Resource already exists
      content:
        application/json:
          schema:
            $ref: '#/components/schemas/ErrorResponse'
          example:
            error: "Project 'my-project' already exists"
            code: CONFLICT

    InternalError:
      description: Internal server error
      content:
        application/json:
          schema:
            $ref: '#/components/schemas/ErrorResponse'
          example:
            error: "Internal server error"
            code: INTERNAL_ERROR

  # ===========================================================================
  # Schemas
  # ===========================================================================
  schemas:
    # -------------------------------------------------------------------------
    # Error Response
    # -------------------------------------------------------------------------
    ErrorResponse:
      type: object
      description: Standard error response format
      required:
        - error
        - code
      properties:
        error:
          type: string
          description: Human-readable error message
          example: "Project 'my-project' not found"
        code:
          type: string
          description: Machine-readable error code
          enum:
            - BAD_REQUEST
            - UNAUTHORIZED
            - FORBIDDEN
            - NOT_FOUND
            - CONFLICT
            - INTERNAL_ERROR
          example: NOT_FOUND
        details:
          type: array
          description: Additional error details (e.g., validation errors)
          items:
            type: object
            properties:
              field:
                type: string
                description: Field that caused the error
                example: name
              message:
                type: string
                description: Error message for this field
                example: must be at least 1 character

    # -------------------------------------------------------------------------
    # Version
    # -------------------------------------------------------------------------
    VersionResponse:
      type: object
      description: Server version information
      required:
        - name
        - version
        - gitRevision
        - buildTime
        - goOS
        - goArch
        - goVersion
      properties:
        name:
          type: string
          description: Application name
          example: openchoreo-api
        version:
          type: string
          description: Version string
          example: v0.1.0
        gitRevision:
          type: string
          description: Git commit SHA
          example: abc1234
        buildTime:
          type: string
          description: Build timestamp
          example: "2025-01-06T10:00:00Z"
        goOS:
          type: string
          description: Target operating system
          example: linux
        goArch:
          type: string
          description: Target architecture
          example: amd64
        goVersion:
          type: string
          description: Go version used to build
          example: go1.24.2

    # -------------------------------------------------------------------------
    # OAuth Protected Resource Metadata
    # -------------------------------------------------------------------------
    OAuthProtectedResourceMetadata:
      type: object
      description: OAuth 2.0 protected resource metadata as defined in RFC 9728
      required:
        - resource_name
        - resource
        - authorization_servers
        - bearer_methods_supported
        - scopes_supported
      properties:
        resource_name:
          type: string
          description: Human-readable name of the protected resource
          example: OpenChoreo MCP Server
        resource:
          type: string
          description: URL of the protected resource
          example: https://api.openchoreo.dev/mcp
        authorization_servers:
          type: array
          description: List of authorization server URLs
          items:
            type: string
          example:
            - https://auth.openchoreo.dev
        bearer_methods_supported:
          type: array
          description: Supported bearer token methods
          items:
            type: string
          example:
            - header
        scopes_supported:
          type: array
          description: Supported OAuth scopes
          items:
            type: string

    # -------------------------------------------------------------------------
    # OIDC Configuration
    # -------------------------------------------------------------------------
    OidcConfig:
      type: object
      description: OIDC configuration for CLI authentication
      required:
        - token_endpoint
      properties:
        authorization_endpoint:
          type: string
          description: OAuth2 authorization endpoint URL
          example: https://auth.openchoreo.dev/authorize
        token_endpoint:
          type: string
          description: OAuth2 token endpoint URL
          example: https://auth.openchoreo.dev/oauth2/token

    # -------------------------------------------------------------------------
    # User Type Configuration
    # -------------------------------------------------------------------------
    UserTypeConfig:
      type: object
      description: Configuration for a user type used in authentication and authorization
      required:
        - type
        - displayName
        - priority
        - authMechanisms
      properties:
        type:
          type: string
          description: User type identifier (e.g., "user", "service_account")
          example: user
        displayName:
          type: string
          description: Human-readable name for the user type
          example: Human User
        priority:
          type: integer
          description: Check order for user type detection (lower = higher priority)
          example: 1
        authMechanisms:
          type: array
          description: Supported authentication mechanisms for this user type
          items:
            $ref: '#/components/schemas/AuthMechanismConfig'

    AuthMechanismConfig:
      type: object
      description: Configuration for an authentication mechanism
      required:
        - type
        - entitlement
      properties:
        type:
          type: string
          description: Authentication mechanism type (e.g., "jwt", "oauth2", "api_key")
          example: jwt
        entitlement:
          $ref: '#/components/schemas/EntitlementConfig'

    EntitlementConfig:
      type: object
      description: Configuration for extracting entitlement claims from tokens
      required:
        - claim
        - displayName
      properties:
        claim:
          type: string
          description: Claim name for detection and entitlement (e.g., "groups", "scopes")
          example: groups
        displayName:
          type: string
          description: Human-readable name for the claim
          example: Groups

    # -------------------------------------------------------------------------
    # Pagination
    # -------------------------------------------------------------------------
    Pagination:
      type: object
      description: |
        Cursor-based pagination metadata. Uses Kubernetes-native continuation tokens
        for efficient pagination through large result sets.
      properties:
        nextCursor:
          type: string
          description: |
            Opaque cursor for fetching the next page. Pass this value as the
            `cursor` query parameter in the next request. Absent when there
            are no more items.
          example: "eyJ2IjoibWV0YS5rOHMuaW8vdjEiLCJydiI6MzQ0N30="
        remainingCount:
          type: integer
          format: int64
          description: |
            Approximate number of items remaining after this page.
            This is an estimate provided by Kubernetes and may not be exact.
            Use for UI hints like "~50 more items". May be absent for
            filtered queries.
          example: 42

    # -------------------------------------------------------------------------
    # Organizations
    # -------------------------------------------------------------------------
    OrganizationList:
      type: object
      description: Paginated list of organizations
      required:
        - items
        - pagination
      properties:
        items:
          type: array
          items:
            $ref: '#/components/schemas/Organization'
        pagination:
          $ref: '#/components/schemas/Pagination'

    Organization:
      type: object
      description: Organization resource
      required:
        - name
        - createdAt
      properties:
        name:
          type: string
          description: Organization name (unique identifier)
          example: my-org
        displayName:
          type: string
          description: Human-readable display name
          example: My Organization
        description:
          type: string
          description: Organization description
          example: Main development organization
        namespace:
          type: string
          description: Kubernetes namespace for the organization
          example: org-my-org
        createdAt:
          type: string
          format: date-time
          description: Creation timestamp
          example: "2025-01-06T10:00:00Z"
        status:
          type: string
          description: Organization status
          example: Ready

    # -------------------------------------------------------------------------
    # Projects
    # -------------------------------------------------------------------------
    ProjectList:
      type: object
      description: Paginated list of projects
      required:
        - items
        - pagination
      properties:
        items:
          type: array
          items:
            $ref: '#/components/schemas/Project'
        pagination:
          $ref: '#/components/schemas/Pagination'

    Project:
      type: object
      description: Project resource
      required:
        - uid
        - name
        - orgName
        - createdAt
      properties:
        uid:
          type: string
          format: uuid
          description: Unique identifier (Kubernetes UID)
          example: 550e8400-e29b-41d4-a716-446655440000
        name:
          type: string
          description: Project name (unique within organization)
          example: my-project
        orgName:
          type: string
          description: Parent organization name
          example: my-org
        displayName:
          type: string
          description: Human-readable display name
          example: My Project
        description:
          type: string
          description: Project description
          example: Backend services project
        deploymentPipeline:
          type: string
          description: Referenced deployment pipeline name
          example: default-pipeline
        createdAt:
          type: string
          format: date-time
          description: Creation timestamp
          example: "2025-01-06T10:00:00Z"
        status:
          type: string
          description: Project status
          example: Ready

    CreateProjectRequest:
      type: object
      description: Request to create a new project
      required:
        - name
      properties:
        name:
          type: string
          description: Project name (must be unique within organization)
          example: my-project
          minLength: 1
          maxLength: 63
          pattern: '^[a-z0-9]([-a-z0-9]*[a-z0-9])?$'
        displayName:
          type: string
          description: Human-readable display name
          example: My Project
          maxLength: 256
        description:
          type: string
          description: Project description
          example: Backend services project
          maxLength: 1024
        deploymentPipeline:
          type: string
          description: Deployment pipeline to use (defaults to organization default)
          example: default-pipeline

    # -------------------------------------------------------------------------
    # Components
    # -------------------------------------------------------------------------
    ComponentList:
      type: object
      description: Paginated list of components
      required:
        - items
        - pagination
      properties:
        items:
          type: array
          items:
            $ref: '#/components/schemas/Component'
        pagination:
          $ref: '#/components/schemas/Pagination'

    Component:
      type: object
      description: Component resource
      required:
        - uid
        - name
        - type
        - projectName
        - orgName
        - createdAt
      properties:
        uid:
          type: string
          format: uuid
          description: Unique identifier (Kubernetes UID)
          example: 550e8400-e29b-41d4-a716-446655440001
        name:
          type: string
          description: Component name (unique within project)
          example: api-service
        displayName:
          type: string
          description: Human-readable display name
          example: API Service
        description:
          type: string
          description: Component description
          example: Main REST API service
        type:
          type: string
          description: Component type (from ComponentType)
          example: service/go-service
        autoDeploy:
          type: boolean
          description: Whether to automatically deploy to default environment
          default: false
          example: true
        projectName:
          type: string
          description: Parent project name
          example: my-project
        orgName:
          type: string
          description: Parent organization name
          example: my-org
        createdAt:
          type: string
          format: date-time
          description: Creation timestamp
          example: "2025-01-06T10:00:00Z"
        status:
          type: string
          description: Component status
          example: Ready
        workload:
          type: object
          description: Workload specification (source code definition)
          additionalProperties: true
        componentWorkflow:
          $ref: '#/components/schemas/ComponentWorkflowConfig'

    ComponentWorkflowConfig:
      type: object
      description: Component workflow configuration
      properties:
        name:
          type: string
          description: Workflow name
          example: docker-build
        systemParameters:
          type: object
          description: System-managed parameters (repository info)
          properties:
            repository:
              type: object
              properties:
                url:
                  type: string
                  description: Git repository URL
                  example: https://github.com/org/repo.git
                revision:
                  type: object
                  properties:
                    branch:
                      type: string
                      description: Git branch
                      example: main
                    commit:
                      type: string
                      description: Git commit SHA
                      example: abc1234
                appPath:
                  type: string
                  description: Path to application within repository
                  example: ./services/api
        parameters:
          type: object
          description: User-defined workflow parameters
          additionalProperties: true

    CreateComponentRequest:
      type: object
      description: Request to create a new component
      required:
        - name
      properties:
        name:
          type: string
          description: Component name (must be unique within project)
          example: api-service
          minLength: 1
          maxLength: 63
          pattern: '^[a-z0-9]([-a-z0-9]*[a-z0-9])?$'
        displayName:
          type: string
          description: Human-readable display name
          example: API Service
          maxLength: 256
        description:
          type: string
          description: Component description
          example: Main REST API service
          maxLength: 1024
        type:
          type: string
          description: "DEPRECATED: Use componentType instead. Legacy component type field."
          example: service/go-service
          deprecated: true
        componentType:
          type: string
          description: "Component type reference (format: {workloadType}/{componentTypeName})"
          example: service/go-service
        autoDeploy:
          type: boolean
          description: Whether to automatically deploy to default environment
          default: false
          example: true
        parameters:
          type: object
          description: Component type parameters
          additionalProperties: true
        traits:
          type: array
          description: Trait instances to attach to the component
          items:
            $ref: '#/components/schemas/ComponentTraitInput'
        workflow:
          $ref: '#/components/schemas/ComponentWorkflowInput'

    ComponentTraitInput:
      type: object
      description: Trait instance to attach to a component
      required:
        - name
        - instanceName
      properties:
        name:
          type: string
          description: Trait resource name
          example: autoscaler
        instanceName:
          type: string
          description: Unique instance name within the component
          example: api-autoscaler
        parameters:
          type: object
          description: Trait parameter values
          additionalProperties: true

    ComponentWorkflowInput:
      type: object
      description: Workflow configuration for component creation
      required:
        - name
        - systemParameters
      properties:
        name:
          type: string
          description: ComponentWorkflow resource name
          example: docker-build
        systemParameters:
          type: object
          description: System parameters including repository configuration
          required:
            - repository
          properties:
            repository:
              type: object
              required:
                - url
                - revision
                - appPath
              properties:
                url:
                  type: string
                  description: Git repository URL
                  example: https://github.com/org/repo.git
                revision:
                  type: object
                  required:
                    - branch
                  properties:
                    branch:
                      type: string
                      description: Git branch to build from
                      example: main
                    commit:
                      type: string
                      description: Specific commit SHA (optional)
                      example: abc1234
                appPath:
                  type: string
                  description: Path to application within repository
                  example: ./services/api
        parameters:
          type: object
          description: User-defined workflow parameters
          additionalProperties: true

    # -------------------------------------------------------------------------
    # Environments
    # -------------------------------------------------------------------------
    EnvironmentList:
      type: object
      description: Paginated list of environments
      required:
        - items
        - pagination
      properties:
        items:
          type: array
          items:
            $ref: '#/components/schemas/Environment'
        pagination:
          $ref: '#/components/schemas/Pagination'

    Environment:
      type: object
      description: Environment resource representing a deployment target
      required:
        - uid
        - name
        - namespace
        - isProduction
        - createdAt
      properties:
        uid:
          type: string
          format: uuid
          description: Unique identifier (Kubernetes UID)
          example: 550e8400-e29b-41d4-a716-446655440002
        name:
          type: string
          description: Environment name (unique within organization)
          example: dev
        namespace:
          type: string
          description: Kubernetes namespace for the environment
          example: org-my-org
        displayName:
          type: string
          description: Human-readable display name
          example: Development
        description:
          type: string
          description: Environment description
          example: Development environment for testing
        dataPlaneRef:
          type: string
          description: Reference to the DataPlane where workloads are deployed
          example: default-dataplane
        isProduction:
          type: boolean
          description: Whether this is a production environment
          example: false
        dnsPrefix:
          type: string
          description: DNS prefix for environment-specific routing
          example: dev
        createdAt:
          type: string
          format: date-time
          description: Creation timestamp
          example: "2025-01-06T10:00:00Z"
        status:
          type: string
          description: Environment status
          example: Ready

    CreateEnvironmentRequest:
      type: object
      description: Request to create a new environment
      required:
        - name
      properties:
        name:
          type: string
          description: Environment name (must be unique within organization)
          example: staging
          minLength: 1
          maxLength: 63
          pattern: '^[a-z0-9]([-a-z0-9]*[a-z0-9])?$'
        displayName:
          type: string
          description: Human-readable display name
          example: Staging Environment
          maxLength: 256
        description:
          type: string
          description: Environment description
          example: Pre-production staging environment
          maxLength: 1024
        dataPlaneRef:
          type: string
          description: Reference to the DataPlane for workload deployment
          example: default-dataplane
        isProduction:
          type: boolean
          description: Whether this is a production environment
          default: false
          example: false
        dnsPrefix:
          type: string
          description: DNS prefix for environment-specific routing
          example: staging

    ObserverURLResponse:
      type: object
      description: Observer URL response for accessing logs and metrics
      properties:
        observerUrl:
          type: string
          description: URL to the observer service for logs and metrics
          example: https://observer.example.com/api/v1
        message:
          type: string
          description: Additional information or status message
          example: Observer URL is available

    # -------------------------------------------------------------------------
    # DataPlanes
    # -------------------------------------------------------------------------
    DataPlaneList:
      type: object
      description: Paginated list of data planes
      required:
        - items
        - pagination
      properties:
        items:
          type: array
          items:
            $ref: '#/components/schemas/DataPlane'
        pagination:
          $ref: '#/components/schemas/Pagination'

    DataPlane:
      type: object
      description: DataPlane resource representing a Kubernetes cluster for workload deployment
      required:
        - name
        - namespace
        - publicVirtualHost
        - organizationVirtualHost
        - publicHTTPPort
        - publicHTTPSPort
        - organizationHTTPPort
        - organizationHTTPSPort
        - createdAt
      properties:
        name:
          type: string
          description: DataPlane name (unique within organization)
          example: default-dataplane
        namespace:
          type: string
          description: Kubernetes namespace for the data plane
          example: org-my-org
        displayName:
          type: string
          description: Human-readable display name
          example: Default Data Plane
        description:
          type: string
          description: DataPlane description
          example: Primary data plane for production workloads
        imagePullSecretRefs:
          type: array
          description: References to image pull secrets
          items:
            type: string
          example: ["docker-registry-secret"]
        secretStoreRef:
          type: string
          description: Reference to the secret store for external secrets
          example: vault-secret-store
        publicVirtualHost:
          type: string
          description: Public virtual host for external traffic
          example: apps.example.com
        organizationVirtualHost:
          type: string
          description: Organization virtual host for internal traffic
          example: internal.example.com
        publicHTTPPort:
          type: integer
          format: int32
          description: Public HTTP port
          example: 80
        publicHTTPSPort:
          type: integer
          format: int32
          description: Public HTTPS port
          example: 443
        organizationHTTPPort:
          type: integer
          format: int32
          description: Organization HTTP port
          example: 8080
        organizationHTTPSPort:
          type: integer
          format: int32
          description: Organization HTTPS port
          example: 8443
        observabilityPlaneRef:
          type: string
          description: Reference to the observability plane
          example: default-observability
        createdAt:
          type: string
          format: date-time
          description: Creation timestamp
          example: "2025-01-06T10:00:00Z"
        status:
          type: string
          description: DataPlane status
          example: Ready

    CreateDataPlaneRequest:
      type: object
      description: Request to create a new data plane
      required:
        - name
        - clusterAgentClientCA
        - publicVirtualHost
        - organizationVirtualHost
      properties:
        name:
          type: string
          description: DataPlane name (must be unique within organization)
          example: production-dataplane
          minLength: 1
          maxLength: 63
          pattern: '^[a-z0-9]([-a-z0-9]*[a-z0-9])?$'
        displayName:
          type: string
          description: Human-readable display name
          example: Production Data Plane
          maxLength: 256
        description:
          type: string
          description: DataPlane description
          example: Data plane for production workloads
          maxLength: 1024
        clusterAgentClientCA:
          type: string
          description: CA certificate for cluster agent client authentication (PEM format)
          example: "-----BEGIN CERTIFICATE-----\n...\n-----END CERTIFICATE-----"
        publicVirtualHost:
          type: string
          description: Public virtual host for external traffic
          example: apps.example.com
        organizationVirtualHost:
          type: string
          description: Organization virtual host for internal traffic
          example: internal.example.com
        publicHTTPPort:
          type: integer
          format: int32
          description: Public HTTP port (defaults to 80)
          example: 80
        publicHTTPSPort:
          type: integer
          format: int32
          description: Public HTTPS port (defaults to 443)
          example: 443
        organizationHTTPPort:
          type: integer
          format: int32
          description: Organization HTTP port (defaults to 8080)
          example: 8080
        organizationHTTPSPort:
          type: integer
          format: int32
          description: Organization HTTPS port (defaults to 8443)
          example: 8443
        observabilityPlaneRef:
          type: string
          description: Reference to the observability plane
          example: default-observability

    # -------------------------------------------------------------------------
    # BuildPlanes
    # -------------------------------------------------------------------------
    BuildPlaneList:
      type: object
      description: Paginated list of build planes
      required:
        - items
        - pagination
      properties:
        items:
          type: array
          items:
            $ref: '#/components/schemas/BuildPlane'
        pagination:
          $ref: '#/components/schemas/Pagination'

    BuildPlane:
      type: object
      description: BuildPlane resource for CI/CD build infrastructure
      required:
        - name
        - namespace
        - createdAt
      properties:
        name:
          type: string
          description: BuildPlane name (unique within organization)
          example: default-buildplane
        namespace:
          type: string
          description: Kubernetes namespace for the build plane
          example: org-my-org
        displayName:
          type: string
          description: Human-readable display name
          example: Default Build Plane
        description:
          type: string
          description: BuildPlane description
          example: Primary build plane for CI/CD workflows
        observabilityPlaneRef:
          type: string
          description: Reference to the observability plane for build logs
          example: default-observability
        createdAt:
          type: string
          format: date-time
          description: Creation timestamp
          example: "2025-01-06T10:00:00Z"
        status:
          type: string
          description: BuildPlane status
          example: Ready

    # -------------------------------------------------------------------------
    # ObservabilityPlanes
    # -------------------------------------------------------------------------
    ObservabilityPlaneList:
      type: object
      description: Paginated list of observability planes
      required:
        - items
        - pagination
      properties:
        items:
          type: array
          items:
            $ref: '#/components/schemas/ObservabilityPlane'
        pagination:
          $ref: '#/components/schemas/Pagination'

    ObservabilityPlane:
      type: object
      description: ObservabilityPlane resource for monitoring and logging infrastructure
      required:
        - name
        - namespace
        - createdAt
      properties:
        name:
          type: string
          description: ObservabilityPlane name (unique within organization)
          example: default-observability
        namespace:
          type: string
          description: Kubernetes namespace for the observability plane
          example: org-my-org
        displayName:
          type: string
          description: Human-readable display name
          example: Default Observability Plane
        description:
          type: string
          description: ObservabilityPlane description
          example: Central observability plane for logs and metrics
        createdAt:
          type: string
          format: date-time
          description: Creation timestamp
          example: "2025-01-06T10:00:00Z"
        status:
          type: string
          description: ObservabilityPlane status
          example: Ready

    # -------------------------------------------------------------------------
    # ComponentTypes
    # -------------------------------------------------------------------------
    ComponentTypeList:
      type: object
      description: Paginated list of component types
      required:
        - items
        - pagination
      properties:
        items:
          type: array
          items:
            $ref: '#/components/schemas/ComponentType'
        pagination:
          $ref: '#/components/schemas/Pagination'

    ComponentType:
      type: object
      description: ComponentType resource defining a workload template
      required:
        - name
        - workloadType
        - createdAt
      properties:
        name:
          type: string
          description: ComponentType name (unique within organization)
          example: go-service
        displayName:
          type: string
          description: Human-readable display name
          example: Go Service
        description:
          type: string
          description: ComponentType description
          example: Template for Go-based microservices
        workloadType:
          type: string
          description: Type of workload (service, web-application, scheduled-task)
          example: service
        allowedWorkflows:
          type: array
          description: List of allowed workflow names for this component type
          items:
            type: string
          example: ["docker-build", "buildpack-build"]
        createdAt:
          type: string
          format: date-time
          description: Creation timestamp
          example: "2025-01-06T10:00:00Z"

    # -------------------------------------------------------------------------
    # Traits
    # -------------------------------------------------------------------------
    TraitList:
      type: object
      description: Paginated list of traits
      required:
        - items
        - pagination
      properties:
        items:
          type: array
          items:
            $ref: '#/components/schemas/Trait'
        pagination:
          $ref: '#/components/schemas/Pagination'

    Trait:
      type: object
      description: Trait resource for composable cross-cutting concerns
      required:
        - name
        - createdAt
      properties:
        name:
          type: string
          description: Trait name (unique within organization)
          example: autoscaler
        displayName:
          type: string
          description: Human-readable display name
          example: Auto Scaler
        description:
          type: string
          description: Trait description
          example: Enables horizontal pod autoscaling
        createdAt:
          type: string
          format: date-time
          description: Creation timestamp
          example: "2025-01-06T10:00:00Z"

    # -------------------------------------------------------------------------
    # Schema Response
    # -------------------------------------------------------------------------
    SchemaResponse:
      type: object
      description: JSON Schema response for component types, traits, or workflows
      additionalProperties: true
      example:
        type: object
        properties:
          replicas:
            type: integer
            default: 1
          port:
            type: integer
            default: 8080

    # -------------------------------------------------------------------------
    # Workflows
    # -------------------------------------------------------------------------
    WorkflowList:
      type: object
      description: Paginated list of workflows
      required:
        - items
        - pagination
      properties:
        items:
          type: array
          items:
            $ref: '#/components/schemas/Workflow'
        pagination:
          $ref: '#/components/schemas/Pagination'

    Workflow:
      type: object
      description: Generic workflow resource
      required:
        - name
        - createdAt
      properties:
        name:
          type: string
          description: Workflow name (unique within organization)
          example: database-migration
        displayName:
          type: string
          description: Human-readable display name
          example: Database Migration
        description:
          type: string
          description: Workflow description
          example: Runs database migration scripts
        createdAt:
          type: string
          format: date-time
          description: Creation timestamp
          example: "2025-01-06T10:00:00Z"

    # -------------------------------------------------------------------------
    # ComponentWorkflows
    # -------------------------------------------------------------------------
    ComponentWorkflowTemplateList:
      type: object
      description: Paginated list of component workflow templates
      required:
        - items
        - pagination
      properties:
        items:
          type: array
          items:
            $ref: '#/components/schemas/ComponentWorkflowTemplate'
        pagination:
          $ref: '#/components/schemas/Pagination'

    ComponentWorkflowTemplate:
      type: object
      description: Component workflow template resource
      required:
        - name
        - createdAt
      properties:
        name:
          type: string
          description: ComponentWorkflow name (unique within organization)
          example: docker-build
        displayName:
          type: string
          description: Human-readable display name
          example: Docker Build
        description:
          type: string
          description: ComponentWorkflow description
          example: Builds container images using Docker
        createdAt:
          type: string
          format: date-time
          description: Creation timestamp
          example: "2025-01-06T10:00:00Z"

    UpdateComponentWorkflowRequest:
      type: object
      description: Request to update component workflow parameters
      properties:
        workflowName:
          type: string
          description: ComponentWorkflow template name to use
          example: docker-build
        systemParameters:
          type: object
          description: System parameters including repository configuration
          properties:
            repository:
              type: object
              properties:
                url:
                  type: string
                  description: Git repository URL
                  example: https://github.com/org/repo.git
                revision:
                  type: object
                  properties:
                    branch:
                      type: string
                      description: Git branch
                      example: main
                    commit:
                      type: string
                      description: Specific commit SHA
                      example: abc1234
                appPath:
                  type: string
                  description: Path to application within repository
                  example: ./services/api
        parameters:
          type: object
          description: User-defined workflow parameters
          additionalProperties: true

    ComponentWorkflowRunList:
      type: object
      description: Paginated list of component workflow runs
      required:
        - items
        - pagination
      properties:
        items:
          type: array
          items:
            $ref: '#/components/schemas/ComponentWorkflowRun'
        pagination:
          $ref: '#/components/schemas/Pagination'

    ComponentWorkflowRun:
      type: object
      description: Component workflow run (build execution)
      required:
        - name
        - componentName
        - projectName
        - orgName
        - createdAt
      properties:
        name:
          type: string
          description: Workflow run name
          example: api-service-run-1234
        uuid:
          type: string
          description: Unique identifier
          example: 550e8400-e29b-41d4-a716-446655440000
        componentName:
          type: string
          description: Parent component name
          example: api-service
        projectName:
          type: string
          description: Parent project name
          example: my-project
        orgName:
          type: string
          description: Parent organization name
          example: my-org
        status:
          type: string
          description: Run status
          example: Running
        commit:
          type: string
          description: Git commit SHA being built
          example: abc1234def5678
        image:
          type: string
          description: Built container image
          example: registry.example.com/my-org/api-service:abc1234
        workflow:
          $ref: '#/components/schemas/ComponentWorkflowConfig'
        createdAt:
          type: string
          format: date-time
          description: Creation timestamp
          example: "2025-01-06T10:00:00Z"

    # -------------------------------------------------------------------------
    # Component Extended Schemas
    # -------------------------------------------------------------------------
    PatchComponentRequest:
      type: object
      description: Request to patch a component
      properties:
        autoDeploy:
          type: boolean
          description: Controls auto-deployment to default environment
          example: true
        parameters:
          type: object
          description: ComponentType parameters
          additionalProperties: true

    ComponentTraitList:
      type: object
      description: List of component traits
      required:
        - items
      properties:
        items:
          type: array
          items:
            $ref: '#/components/schemas/ComponentTrait'

    ComponentTrait:
      type: object
      description: Trait attached to a component
      required:
        - name
        - instanceName
      properties:
        name:
          type: string
          description: Trait template name
          example: autoscaler
        instanceName:
          type: string
          description: Instance name for this trait attachment
          example: my-autoscaler
        parameters:
          type: object
          description: Trait parameters
          additionalProperties: true

    UpdateComponentTraitsRequest:
      type: object
      description: Request to update component traits
      required:
        - traits
      properties:
        traits:
          type: array
          items:
            $ref: '#/components/schemas/ComponentTraitInput'

    # -------------------------------------------------------------------------
    # Bindings
    # -------------------------------------------------------------------------
    BindingList:
      type: object
      description: Paginated list of bindings
      required:
        - items
        - pagination
      properties:
        items:
          type: array
          items:
            $ref: '#/components/schemas/Binding'
        pagination:
          $ref: '#/components/schemas/Pagination'

    Binding:
      type: object
      description: Deployment binding for a component in an environment
      required:
        - name
        - type
        - componentName
        - projectName
        - orgName
        - environment
        - status
      properties:
        name:
          type: string
          description: Binding name
          example: api-service-dev
        type:
          type: string
          description: Binding type
          example: service
        componentName:
          type: string
          description: Parent component name
          example: api-service
        projectName:
          type: string
          description: Parent project name
          example: my-project
        orgName:
          type: string
          description: Parent organization name
          example: my-org
        environment:
          type: string
          description: Target environment name
          example: dev
        status:
          $ref: '#/components/schemas/BindingStatus'
        serviceBinding:
          $ref: '#/components/schemas/ServiceBinding'
        webApplicationBinding:
          $ref: '#/components/schemas/WebApplicationBinding'
        scheduledTaskBinding:
          $ref: '#/components/schemas/ScheduledTaskBinding'

    BindingStatus:
      type: object
      description: Status of a binding
      properties:
        status:
          type: string
          description: Status type
          enum: [InProgress, Active, Failed, Suspended]
          example: Active
        reason:
          type: string
          description: Human-readable status reason
          example: Deployment complete
        message:
          type: string
          description: Human-readable status message
          example: All replicas are ready
        lastTransitioned:
          type: string
          format: date-time
          description: Last status transition time
          example: "2025-01-06T10:00:00Z"

    EndpointStatus:
      type: object
      description: Status of an exposed endpoint
      properties:
        name:
          type: string
          description: Endpoint name
          example: http
        type:
          type: string
          description: Endpoint type
          example: http
        project:
          $ref: '#/components/schemas/ExposedEndpoint'
        organization:
          $ref: '#/components/schemas/ExposedEndpoint'
        public:
          $ref: '#/components/schemas/ExposedEndpoint'

    ExposedEndpoint:
      type: object
      description: Exposed endpoint details
      properties:
        host:
          type: string
          description: Endpoint hostname
          example: api.example.com
        port:
          type: integer
          description: Endpoint port
          example: 443
        scheme:
          type: string
          description: URL scheme
          example: https
        basePath:
          type: string
          description: Base path
          example: /api/v1
        uri:
          type: string
          description: Full URI
          example: https://api.example.com:443/api/v1

    ServiceBinding:
      type: object
      description: Service-specific binding data
      properties:
        endpoints:
          type: array
          description: Exposed endpoints
          items:
            $ref: '#/components/schemas/EndpointStatus'
        image:
          type: string
          description: Container image
          example: registry.example.com/my-org/api-service:v1.0.0
        releaseState:
          type: string
          description: Release state
          example: Active

    WebApplicationBinding:
      type: object
      description: Web application-specific binding data
      properties:
        endpoints:
          type: array
          description: Exposed endpoints
          items:
            $ref: '#/components/schemas/EndpointStatus'
        image:
          type: string
          description: Container image
          example: registry.example.com/my-org/web-app:v1.0.0
        releaseState:
          type: string
          description: Release state
          example: Active

    ScheduledTaskBinding:
      type: object
      description: Scheduled task-specific binding data
      properties:
        image:
          type: string
          description: Container image
          example: registry.example.com/my-org/cron-job:v1.0.0
        releaseState:
          type: string
          description: Release state
          example: Active

    UpdateBindingRequest:
      type: object
      description: Request to update a binding
      required:
        - releaseState
      properties:
        releaseState:
          type: string
          description: Desired release state
          enum: [Active, Suspend, Undeploy]
          example: Active

    # -------------------------------------------------------------------------
    # Component Releases
    # -------------------------------------------------------------------------
    ComponentReleaseList:
      type: object
      description: Paginated list of component releases
      required:
        - items
        - pagination
      properties:
        items:
          type: array
          items:
            $ref: '#/components/schemas/ComponentRelease'
        pagination:
          $ref: '#/components/schemas/Pagination'

    ComponentRelease:
      type: object
      description: Immutable release snapshot for a component
      required:
        - name
        - componentName
        - projectName
        - orgName
        - createdAt
      properties:
        name:
          type: string
          description: Release name
          example: v1.0.0
        componentName:
          type: string
          description: Parent component name
          example: api-service
        projectName:
          type: string
          description: Parent project name
          example: my-project
        orgName:
          type: string
          description: Parent organization name
          example: my-org
        createdAt:
          type: string
          format: date-time
          description: Creation timestamp
          example: "2025-01-06T10:00:00Z"
        status:
          type: string
          description: Release status
          example: Ready

    CreateComponentReleaseRequest:
      type: object
      description: Request to create a component release
      properties:
        releaseName:
          type: string
          description: Optional release name (auto-generated if not provided)
          example: v1.0.0

    # -------------------------------------------------------------------------
    # Release Bindings
    # -------------------------------------------------------------------------
    ReleaseBindingList:
      type: object
      description: Paginated list of release bindings
      required:
        - items
        - pagination
      properties:
        items:
          type: array
          items:
            $ref: '#/components/schemas/ReleaseBinding'
        pagination:
          $ref: '#/components/schemas/Pagination'

    ReleaseBinding:
      type: object
      description: Environment-specific release binding
      required:
        - name
        - componentName
        - projectName
        - orgName
        - environment
        - createdAt
      properties:
        name:
          type: string
          description: Binding name
          example: api-service-dev
        componentName:
          type: string
          description: Parent component name
          example: api-service
        projectName:
          type: string
          description: Parent project name
          example: my-project
        orgName:
          type: string
          description: Parent organization name
          example: my-org
        environment:
          type: string
          description: Target environment name
          example: dev
        releaseName:
          type: string
          description: Reference to component release
          example: v1.0.0
        componentTypeEnvOverrides:
          type: object
          description: Environment-specific ComponentType overrides
          additionalProperties: true
        traitOverrides:
          type: object
          description: Environment-specific trait overrides
          additionalProperties: true
        workloadOverrides:
          $ref: '#/components/schemas/WorkloadOverrides'
        createdAt:
          type: string
          format: date-time
          description: Creation timestamp
          example: "2025-01-06T10:00:00Z"
        status:
          type: string
          description: Binding status
          example: Ready

    PatchReleaseBindingRequest:
      type: object
      description: Request to patch a release binding
      properties:
        releaseName:
          type: string
          description: Component release name to deploy
          example: v1.0.0
        componentTypeEnvOverrides:
          type: object
          description: Environment-specific ComponentType overrides
          additionalProperties: true
        traitOverrides:
          type: object
          description: Environment-specific trait overrides
          additionalProperties: true
        workloadOverrides:
          $ref: '#/components/schemas/WorkloadOverrides'

    WorkloadOverrides:
      type: object
      description: Environment-specific workload overrides
      properties:
        containers:
          type: object
          description: Container overrides keyed by container name
          additionalProperties:
            $ref: '#/components/schemas/ContainerOverride'

    ContainerOverride:
      type: object
      description: Container-level overrides
      properties:
        env:
          type: array
          items:
            $ref: '#/components/schemas/EnvVar'
        files:
          type: array
          items:
            $ref: '#/components/schemas/FileVar'

    EnvVar:
      type: object
      description: Environment variable
      required:
        - key
      properties:
        key:
          type: string
          description: Variable key/name
          example: DATABASE_URL
        value:
          type: string
          description: Variable value
          example: postgres://localhost:5432/db
        valueFrom:
          $ref: '#/components/schemas/EnvVarValueFrom'

    EnvVarValueFrom:
      type: object
      description: Value source reference
      properties:
        secretRef:
          type: object
          description: Secret reference
          properties:
            name:
              type: string
              description: Secret name
            key:
              type: string
              description: Secret key

    FileVar:
      type: object
      description: File mount variable
      required:
        - key
        - mountPath
      properties:
        key:
          type: string
          description: File key/name
          example: config.yaml
        mountPath:
          type: string
          description: Mount path in container
          example: /app/config
        value:
          type: string
          description: File content
        valueFrom:
          $ref: '#/components/schemas/EnvVarValueFrom'

    # -------------------------------------------------------------------------
    # Release
    # -------------------------------------------------------------------------
    Release:
      type: object
      description: Deployed release with Kubernetes resources
      properties:
        spec:
          type: object
          description: Release specification
          properties:
            resources:
              type: array
              description: Kubernetes resources in this release
              items:
                type: object
                additionalProperties: true
        status:
          type: object
          description: Release status
          additionalProperties: true

    # -------------------------------------------------------------------------
    # Deploy/Promote Requests
    # -------------------------------------------------------------------------
    DeployReleaseRequest:
      type: object
      description: Request to deploy a release
      required:
        - releaseName
      properties:
        releaseName:
          type: string
          description: Component release name to deploy
          example: v1.0.0

    PromoteComponentRequest:
      type: object
      description: Request to promote a component between environments
      required:
        - sourceEnv
        - targetEnv
      properties:
        sourceEnv:
          type: string
          description: Source environment name
          example: dev
        targetEnv:
          type: string
          description: Target environment name
          example: staging

    # -------------------------------------------------------------------------
    # Authorization Schemas
    # -------------------------------------------------------------------------
    MessageResponse:
      type: object
      description: Simple message response
      required:
        - message
      properties:
        message:
          type: string
          description: Response message
          example: Operation completed successfully

    Role:
      type: object
      description: Authorization role with permitted actions
      required:
        - name
        - actions
      properties:
        name:
          type: string
          description: Unique role name
          example: admin
        actions:
          type: array
          description: List of actions this role permits
          items:
            type: string
          example: ["read", "write", "delete"]

    UpdateRoleRequest:
      type: object
      description: Request to update a role's actions
      required:
        - actions
      properties:
        actions:
          type: array
          description: New list of actions for the role
          items:
            type: string
          example: ["read", "write"]

    Entitlement:
      type: object
      description: Entitlement with claim and value
      required:
        - claim
        - value
      properties:
        claim:
          type: string
          description: JWT claim name
          example: group
        value:
          type: string
          description: Entitlement value
          example: admin-group

    ResourceHierarchy:
      type: object
      description: Resource hierarchy scope
      properties:
        organization:
          type: string
          description: Organization name
          example: my-org
        organization_units:
          type: array
          description: Organization unit names
          items:
            type: string
          example: ["team-a"]
        project:
          type: string
          description: Project name
          example: my-project
        component:
          type: string
          description: Component name
          example: api-service

    AuthzContext:
      type: object
      description: Additional context for authorization
      additionalProperties: true

    RoleEntitlementMapping:
      type: object
      description: Mapping of a role to an entitlement within a scope
      properties:
        id:
          type: integer
          format: int64
          description: Unique mapping ID
          example: 123
        role_name:
          type: string
          description: Name of the role being assigned
          example: admin
        entitlement:
          $ref: '#/components/schemas/Entitlement'
        hierarchy:
          $ref: '#/components/schemas/ResourceHierarchy'
        effect:
          type: string
          description: Policy effect (allow or deny)
          enum: [allow, deny]
          example: allow
        context:
          $ref: '#/components/schemas/AuthzContext'

    UpdateRoleMappingRequest:
      type: object
      description: Request to update a role mapping
      required:
        - role_name
        - entitlement
      properties:
        role_name:
          type: string
          description: Role name
          example: admin
        entitlement:
          $ref: '#/components/schemas/Entitlement'
        hierarchy:
          $ref: '#/components/schemas/ResourceHierarchy'
        effect:
          type: string
          description: Policy effect
          enum: [allow, deny]
          example: allow
        context:
          $ref: '#/components/schemas/AuthzContext'

    SubjectContext:
      type: object
      description: Authenticated subject context
      required:
        - type
      properties:
        type:
          type: string
          description: Subject type
          enum: [user, service_account]
          example: user
        entitlement_claim:
          type: string
          description: Entitlement claim name
          example: group
        entitlement_values:
          type: array
          description: Entitlement values
          items:
            type: string
          example: ["admin-group", "dev-group"]

    Resource:
      type: object
      description: Resource for authorization evaluation
      required:
        - type
        - hierarchy
      properties:
        type:
          type: string
          description: Resource type
          example: component
        id:
          type: string
          description: Resource ID
          example: api-service
        hierarchy:
          $ref: '#/components/schemas/ResourceHierarchy'

    EvaluateRequest:
      type: object
      description: Single authorization evaluation request
      required:
        - resource
        - action
      properties:
        subject_context:
          $ref: '#/components/schemas/SubjectContext'
        resource:
          $ref: '#/components/schemas/Resource'
        action:
          type: string
          description: Action to evaluate
          example: read
        context:
          $ref: '#/components/schemas/AuthzContext'

    Decision:
      type: object
      description: Authorization decision
      required:
        - decision
      properties:
        decision:
          type: boolean
          description: Authorization result (true = allowed)
          example: true
        context:
          type: object
          description: Additional decision context
          properties:
            reason:
              type: string
              description: Reason for the decision
              example: User has admin role

    BatchEvaluateRequest:
      type: object
      description: Batch authorization evaluation request
      required:
        - requests
      properties:
        requests:
          type: array
          description: List of evaluation requests
          items:
            $ref: '#/components/schemas/EvaluateRequest'

    BatchEvaluateResponse:
      type: object
      description: Batch authorization evaluation response
      required:
        - decisions
      properties:
        decisions:
          type: array
          description: List of decisions (in same order as requests)
          items:
            $ref: '#/components/schemas/Decision'

    ActionCapability:
      type: object
      description: Capabilities for a specific action
      properties:
        allowed:
          type: array
          description: Resources where action is allowed
          items:
            $ref: '#/components/schemas/CapabilityResource'
        denied:
          type: array
          description: Resources where action is denied
          items:
            $ref: '#/components/schemas/CapabilityResource'

    CapabilityResource:
      type: object
      description: Resource with permission details
      properties:
        path:
          type: string
          description: Full resource path
          example: org/acme/project/payment
        constraints:
          type: object
          description: Additional instance-level restrictions
          additionalProperties: true

    UserCapabilitiesResponse:
      type: object
      description: User authorization profile response
      properties:
        user:
          $ref: '#/components/schemas/SubjectContext'
        capabilities:
          type: object
          description: Map of action to capabilities
          additionalProperties:
            $ref: '#/components/schemas/ActionCapability'
        evaluatedAt:
          type: string
          format: date-time
          description: Time when capabilities were evaluated
          example: "2025-01-06T10:00:00Z"

    # -------------------------------------------------------------------------
    # Webhook Schemas
    # -------------------------------------------------------------------------
    WebhookEventResponse:
      type: object
      description: Response after processing a webhook event
      required:
        - success
        - message
        - triggeredBuilds
      properties:
        success:
          type: boolean
          description: Whether the webhook was processed successfully
          example: true
        message:
          type: string
          description: Status message
          example: Webhook processed successfully
        affectedComponents:
          type: array
          description: List of components affected by this webhook
          items:
            type: string
          example: ["api-service", "web-app"]
        triggeredBuilds:
          type: integer
          description: Number of builds triggered
          example: 2

    # -------------------------------------------------------------------------
    # Resource Apply/Delete Schemas
    # -------------------------------------------------------------------------
    KubernetesResource:
      type: object
      description: Kubernetes resource with OpenChoreo API group
      required:
        - apiVersion
        - kind
        - metadata
      properties:
        apiVersion:
          type: string
          description: API version (must be openchoreo.dev/v1alpha1)
          example: openchoreo.dev/v1alpha1
        kind:
          type: string
          description: Resource kind
          example: Component
        metadata:
          type: object
          description: Resource metadata
          required:
            - name
          properties:
            name:
              type: string
              description: Resource name
              example: my-component
            namespace:
              type: string
              description: Kubernetes namespace
              example: org-my-org
          additionalProperties: true
        spec:
          type: object
          description: Resource specification
          additionalProperties: true

    ApplyResourceResponse:
      type: object
      description: Response from applying a resource
      required:
        - apiVersion
        - kind
        - name
        - operation
      properties:
        apiVersion:
          type: string
          description: Applied resource API version
          example: openchoreo.dev/v1alpha1
        kind:
          type: string
          description: Applied resource kind
          example: Component
        name:
          type: string
          description: Applied resource name
          example: my-component
        namespace:
          type: string
          description: Applied resource namespace
          example: org-my-org
        operation:
          type: string
          description: Operation performed
          enum: [created, updated, unchanged]
          example: created

    DeleteResourceResponse:
      type: object
      description: Response from deleting a resource
      required:
        - apiVersion
        - kind
        - name
        - operation
      properties:
        apiVersion:
          type: string
          description: Deleted resource API version
          example: openchoreo.dev/v1alpha1
        kind:
          type: string
          description: Deleted resource kind
          example: Component
        name:
          type: string
          description: Deleted resource name
          example: my-component
        namespace:
          type: string
          description: Deleted resource namespace
          example: org-my-org
        operation:
          type: string
          description: Operation result
          enum: [deleted, not_found]
          example: deleted

    # -------------------------------------------------------------------------
    # Secret Reference Schemas
    # -------------------------------------------------------------------------
    SecretReferenceList:
      type: object
      description: Paginated list of secret references
      required:
        - items
        - pagination
      properties:
        items:
          type: array
          items:
            $ref: '#/components/schemas/SecretReference'
        pagination:
          $ref: '#/components/schemas/Pagination'

    SecretReference:
      type: object
      description: Secret reference resource
      required:
        - name
        - namespace
        - createdAt
      properties:
        name:
          type: string
          description: Secret reference name
          example: my-secret
        namespace:
          type: string
          description: Kubernetes namespace
          example: org-my-org
        displayName:
          type: string
          description: Human-readable display name
          example: My Secret
        description:
          type: string
          description: Secret reference description
          example: Database credentials
        secretStores:
          type: array
          description: Secret store references
          items:
            $ref: '#/components/schemas/SecretStoreReference'
        refreshInterval:
          type: string
          description: Refresh interval for secret sync
          example: 1h
        data:
          type: array
          description: Secret data sources
          items:
            $ref: '#/components/schemas/SecretDataSource'
        createdAt:
          type: string
          format: date-time
          description: Creation timestamp
          example: "2025-01-06T10:00:00Z"
        lastRefreshTime:
          type: string
          format: date-time
          description: Last refresh time
          example: "2025-01-06T11:00:00Z"
        status:
          type: string
          description: Secret reference status
          example: Ready

    SecretStoreReference:
      type: object
      description: Reference to a secret store
      required:
        - name
        - kind
      properties:
        name:
          type: string
          description: Secret store name
          example: vault-store
        namespace:
          type: string
          description: Secret store namespace
          example: org-my-org
        kind:
          type: string
          description: Secret store kind
          example: SecretStore

    SecretDataSource:
      type: object
      description: Secret data source information
      required:
        - secretKey
        - remoteRef
      properties:
        secretKey:
          type: string
          description: Key in the Kubernetes secret
          example: database-password
        remoteRef:
          $ref: '#/components/schemas/RemoteReference'

    RemoteReference:
      type: object
      description: Remote secret reference
      required:
        - key
      properties:
        key:
          type: string
          description: Key in the external secret store
          example: prod/database/password
        property:
          type: string
          description: Property within the secret
          example: password
        version:
          type: string
          description: Secret version
          example: 1

    # -------------------------------------------------------------------------
    # Workload Schemas
    # -------------------------------------------------------------------------
    WorkloadSpec:
      type: object
      description: Workload specification (source code definition)
      additionalProperties: true
      example:
        containers:
          main:
            image: registry.example.com/my-org/api:v1.0.0
            ports:
              - containerPort: 8080
        endpoints:
          - name: http
            port: 8080

    # -------------------------------------------------------------------------
    # Deployment Pipeline Schemas
    # -------------------------------------------------------------------------
    DeploymentPipeline:
      type: object
      description: Deployment pipeline resource
      required:
        - name
        - orgName
        - createdAt
      properties:
        name:
          type: string
          description: Pipeline name
          example: default-pipeline
        displayName:
          type: string
          description: Human-readable display name
          example: Default Pipeline
        description:
          type: string
          description: Pipeline description
          example: Standard deployment pipeline with dev, staging, and prod
        orgName:
          type: string
          description: Parent organization name
          example: my-org
        createdAt:
          type: string
          format: date-time
          description: Creation timestamp
          example: "2025-01-06T10:00:00Z"
        status:
          type: string
          description: Pipeline status
          example: Ready
        promotionPaths:
          type: array
          description: Promotion paths between environments
          items:
            $ref: '#/components/schemas/PromotionPath'

    PromotionPath:
      type: object
      description: Promotion path between environments
      required:
        - sourceEnvironmentRef
        - targetEnvironmentRefs
      properties:
        sourceEnvironmentRef:
          type: string
          description: Source environment name
          example: dev
        targetEnvironmentRefs:
          type: array
          description: Target environments for promotion
          items:
            $ref: '#/components/schemas/TargetEnvironmentRef'

    TargetEnvironmentRef:
      type: object
      description: Target environment reference with approval settings
      required:
        - name
      properties:
        name:
          type: string
          description: Target environment name
          example: staging
        requiresApproval:
          type: boolean
          description: Whether promotion requires approval
          example: false
        isManualApprovalRequired:
          type: boolean
          description: Whether manual approval is required
          example: true
